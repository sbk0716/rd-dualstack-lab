---
title: "Docker ã§ä½“é¨“ã™ã‚‹ IPv6 Dual Stack å…¥é–€"
emoji: "ğŸŒ"
type: "tech"
topics: ["ipv6", "docker", "network", "azure", "infrastructure"]
published: false
---

# ã¯ã˜ã‚ã«

ã€ŒIPv6 ã£ã¦èã„ãŸã“ã¨ã¯ã‚ã‚‹ã‘ã©ã€ã‚ˆãã‚ã‹ã‚‰ãªã„ã€
ã€ŒIPv4 ã§å›°ã£ã¦ã„ãªã„ã—ã€å­¦ã¶å¿…è¦ãŒã‚ã‚‹ã®ã ã‚ã†ã‹ã€

ã“ã®ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã‚‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ã¯ã€å°‘ãªããªã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚å®Ÿã¯ã€ç§è‡ªèº«ã‚‚ãã†ã§ã—ãŸã€‚

ã“ã®è¨˜äº‹ã¯ã€**IPv6 ã®çŸ¥è­˜ãŒã¾ã£ãŸããªã„**ã‚¸ãƒ¥ãƒ‹ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹ã‚’å¯¾è±¡ã«ã€Docker ã‚’ä½¿ã£ã¦ IPv4 ã¨ IPv6 ãŒå…±å­˜ã™ã‚‹ã€Œ**Dual Stack**ã€ç’°å¢ƒã‚’å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦ä½“é¨“ã—ã¦ã„ãŸã ããƒãƒ³ã‚ºã‚ªãƒ³è¨˜äº‹ã§ã™ã€‚

## ã“ã®è¨˜äº‹ã®ç›®çš„

- IPv6 ã®**æœ€ä½é™ã®åŸºç¤çŸ¥è­˜**ã‚’èº«ã«ã¤ã‘ã‚‹
- Docker ã§**ãƒ­ãƒ¼ã‚«ãƒ«ã« Dual Stack ç’°å¢ƒ**ã‚’æ§‹ç¯‰ã™ã‚‹
- IPv4/IPv6 ã®ç–é€šã€DNSã€**ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ**ã‚’ä½“é¨“ã™ã‚‹
- ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆAzureï¼‰ã§ã® IPv6 è¨­è¨ˆã«ã¤ãªã’ã‚‹

## å¯¾è±¡èª­è€…

- IPv6 ã‚’è§¦ã£ãŸã“ã¨ãŒãªã„ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ–¹
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®åŸºç¤ï¼ˆIP ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ã‚µãƒ–ãƒãƒƒãƒˆï¼‰ã¯ç†è§£ã•ã‚Œã¦ã„ã‚‹æ–¹
- Docker / Docker Compose ãŒä½¿ãˆã‚‹ç’°å¢ƒã‚’ãŠæŒã¡ã®æ–¹

## ã€ŒAzure é–‰åŸŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆå…¥é–€ã€ã¨ã®é–¢ä¿‚

ã“ã®è¨˜äº‹ã¯ã€ç§ãŒåŸ·ç­†ã—ãŸ Zenn æœ¬ã€Œ[Azure é–‰åŸŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆå…¥é–€](https://zenn.dev/sbk0716/books/b39367c534044c)ã€ã®**è£œè¶³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**ã¨ã—ã¦ä½œæˆã—ã¾ã—ãŸã€‚

ã“ã®æ›¸ç±ã§ã¯ç¬¬ 13 ç« ã§ã€ŒIPv6 Dual Stackã€ã‚’ã€Appendix F ã§ã€ŒAzure ã‚µãƒ¼ãƒ“ã‚¹ IPv6 å¯¾å¿œçŠ¶æ³ã€ã‚’è§£èª¬ã—ã¦ãŠã‚Šã¾ã™ãŒã€Azure å›ºæœ‰ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«è¸ã¿è¾¼ã‚€å‰ã«ã€ã¾ãš **IPv6 ãã®ã‚‚ã®ã‚’ä½“é¨“**ã—ã¦ã„ãŸã ãã“ã¨ã§ç†è§£ãŒæ·±ã¾ã‚‹ã¨è€ƒãˆã€ã“ã®è¨˜äº‹ã‚’ä½œæˆã„ãŸã—ã¾ã—ãŸã€‚

```
ã“ã®è¨˜äº‹ï¼ˆIPv6 ã®åŸºç¤ä½“é¨“ï¼‰
    â†“
æ›¸ç± ç¬¬ 13 ç« ï¼ˆAzure ã§ã® IPv6 è¨­è¨ˆï¼‰
    â†“
æ›¸ç± Appendix F/Kï¼ˆåˆ¶ç´„äº‹é …ã¨ä»–ã‚¯ãƒ©ã‚¦ãƒ‰æ¯”è¼ƒï¼‰
```

---

# ãªãœä»Š IPv6 ã‚’å­¦ã¶ã®ã‹

## IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Œæ¯æ¸‡ã€ã—ã¦ã„ã‚‹

IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç´„ **43 å„„å€‹**ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸–ç•Œäººå£ãŒ 80 å„„äººã‚’è¶…ãˆãŸç¾åœ¨ã€1 äºº 1 ã‚¢ãƒ‰ãƒ¬ã‚¹ã™ã‚‰å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ããªã„çŠ¶æ³ã§ã™ã€‚

```
IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°: 2^32 = ç´„ 43 å„„å€‹
ä¸–ç•Œäººå£:        ç´„ 80 å„„äºº
ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³:  ç´„ 70 å„„å°
IoT ãƒ‡ãƒã‚¤ã‚¹:    ç´„ 150 å„„å°ï¼ˆ2025 å¹´äºˆæ¸¬ã§ã¯ 270 å„„å°ï¼‰
```

### IPv4 æ¯æ¸‡ã®æ­´å²

ä»¥ä¸‹ã¯ã€ä¸–ç•Œå„åœ°åŸŸã§ IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ—ãƒ¼ãƒ«ãŒæ¯æ¸‡ã—ãŸæ­£ç¢ºãªæ—¥ä»˜ã§ã™ã€‚

| çµ„ç¹”      | æ¯æ¸‡æ—¥          | åœ°åŸŸ                      | å‚™è€ƒ                           |
| --------- | --------------- | ------------------------- | ------------------------------ |
| **IANA**  | 2011å¹´2æœˆ3æ—¥    | å…¨ä¸–ç•Œï¼ˆä¸­å¤®åœ¨åº«ï¼‰        | æœ€å¾Œã® /8 ãƒ–ãƒ­ãƒƒã‚¯ã‚’ 5 RIR ã«åˆ†é… |
| **APNIC** | 2011å¹´4æœˆ15æ—¥   | ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹ï¼ˆæ—¥æœ¬å«ã‚€ï¼‰  | IANA æ¯æ¸‡å¾Œã‚ãšã‹ 2 ãƒ¶æœˆã§æ¯æ¸‡  |
| **RIPE NCC** | 2012å¹´9æœˆ14æ—¥ | ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã€ä¸­æ±ã€ä¸­å¤®ã‚¢ã‚¸ã‚¢ | æœ€å¾Œã® /8 ã‚’ä½¿ã„åˆ‡ã‚‹          |
| **LACNIC** | 2014å¹´6æœˆ10æ—¥  | ä¸­å—ç±³ã€ã‚«ãƒªãƒ–æµ·          | -                              |
| **ARIN**  | 2015å¹´9æœˆ24æ—¥   | åŒ—ç±³                      | å¾…æ©Ÿãƒªã‚¹ãƒˆåˆ¶åº¦ã‚’å°å…¥           |
| **AFRINIC** | 2017å¹´4æœˆ21æ—¥ | ã‚¢ãƒ•ãƒªã‚«                  | æœ€å¾Œã«æ¯æ¸‡ã—ãŸ RIR             |

> **å‡ºå…¸**: [IANA IPv4 Address Space Registry](https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xhtml)

æ—¥æœ¬ãŒå±ã™ã‚‹ APNIC ã¯ã€IANA æ¯æ¸‡ã‹ã‚‰ã‚ãšã‹ 2 ãƒ¶æœˆå¾Œã® 2011 å¹´ 4 æœˆã«æ¯æ¸‡ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯ã€ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹åœ°åŸŸã§ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆéœ€è¦ã®æ€¥å¢—ã‚’åæ˜ ã—ã¦ã„ã¾ã™ã€‚

> **ç”¨èªè§£èª¬: RIRï¼ˆRegional Internet Registryï¼‰ã¨ã¯ï¼Ÿ**
> IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’åœ°åŸŸã”ã¨ã«ç®¡ç†ãƒ»åˆ†é…ã™ã‚‹çµ„ç¹”ã§ã™ã€‚ä¸–ç•Œã« 5 ã¤ã‚ã‚Šã¾ã™ã€‚
> - **ARIN**: åŒ—ç±³
> - **RIPE NCC**: ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã€ä¸­æ±ã€ä¸­å¤®ã‚¢ã‚¸ã‚¢
> - **APNIC**: ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹ï¼ˆæ—¥æœ¬ã¯ã“ã“ï¼‰
> - **LACNIC**: ä¸­å—ç±³ã€ã‚«ãƒªãƒ–æµ·
> - **AFRINIC**: ã‚¢ãƒ•ãƒªã‚«

### ç¾åœ¨ã®å»¶å‘½ç­–ã¨ãã®å•é¡Œç‚¹

ç¾åœ¨ã¯ NATï¼ˆNetwork Address Translationï¼‰ã‚„ CGNATï¼ˆCarrier-Grade NATï¼‰ã§å»¶å‘½ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‰ã«ã¯ä»¥ä¸‹ã®å•é¡ŒãŒã‚ã‚Šã¾ã™:

| å»¶å‘½ç­–        | ä»•çµ„ã¿                                                | å•é¡Œç‚¹                                                           |
| ------------- | ----------------------------------------------------- | ---------------------------------------------------------------- |
| **NAT**       | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ« IP ã«å¤‰æ›                | End-to-End é€šä¿¡ãŒå›°é›£ã«ãªã‚‹ï¼ˆP2Pã€VoIPã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã«å½±éŸ¿ï¼‰ |
| **CGNAT**     | ISP ãŒã•ã‚‰ã« NAT ã‚’è¡Œã„ã€è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã§åŒä¸€ IP ã‚’å…±æœ‰ | IP ãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™ãŒæ©Ÿèƒ½ã—ãªã„ã€ãƒ­ã‚°è¿½è·¡ãŒå›°é›£              |
| **IPv4 å£²è²·** | æœªä½¿ç”¨ã® IPv4 ãƒ–ãƒ­ãƒƒã‚¯ã‚’å£²è²·                          | ä¾¡æ ¼ãŒé«˜é¨°ï¼ˆ/24 ã§æ•°ä¸‡ãƒ‰ãƒ«ï¼‰ã€ä¸­å°ä¼æ¥­ã«ã¯æ‰‹ãŒå±Šã‹ãªã„           |

## å¤§è¦æ¨¡çµ„ç¹”ã§ã®èª²é¡Œ

ã€Œè‡ªç¤¾ã§ã¯å›°ã£ã¦ã„ãªã„ã€ã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã—ã‹ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚·ãƒŠãƒªã‚ªã§ã¯ IPv4 ã®é™ç•Œã«ç›´é¢ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚·ãƒŠãƒªã‚ª 1: M&Aï¼ˆä¼æ¥­åˆä½µï¼‰

ä¼æ¥­ãŒåˆä½µã™ã‚‹ã¨ãã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚‚çµ±åˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã—ã€ä¸¡ç¤¾ãŒåŒã˜ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ä½¿ã£ã¦ã„ãŸå ´åˆã€æ·±åˆ»ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚

```
ã€è²·åå‰ã€‘
  Aç¤¾ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: 10.0.0.0/8 ã‚’ä½¿ç”¨
    - ç¤¾å†…ã‚µãƒ¼ãƒ: 10.1.1.0/24
    - é–‹ç™ºç’°å¢ƒ:   10.2.0.0/16

  Bç¤¾ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯: 10.0.0.0/8 ã‚’ä½¿ç”¨ï¼ˆåŒã˜ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ï¼ï¼‰
    - ç¤¾å†…ã‚µãƒ¼ãƒ: 10.1.1.0/24  â† Aç¤¾ã¨é‡è¤‡ï¼
    - æœ¬ç•ªç’°å¢ƒ:   10.3.0.0/16

ã€è²·åå¾Œã®å•é¡Œã€‘
  - 10.1.1.1 ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€Aç¤¾ã®ã‚µãƒ¼ãƒï¼ŸBç¤¾ã®ã‚µãƒ¼ãƒï¼Ÿ
  - ã©ã¡ã‚‰ã‹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å…¨é¢çš„ã«å†è¨­è¨ˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  - å†è¨­è¨ˆã«ã¯æ•°ãƒ¶æœˆã€œæ•°å¹´ã€å¤šå¤§ãªã‚³ã‚¹ãƒˆãŒã‹ã‹ã‚‹
```

### ã‚·ãƒŠãƒªã‚ª 2: ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ / Kubernetes

å¾“æ¥ã®ãƒ¢ãƒãƒªã‚·ãƒƒã‚¯ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨æ¯”ã¹ã¦ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã¯å¿…è¦ãª IP ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°ãŒæ¡é•ã„ã«å¢—åŠ ã—ã¾ã™ã€‚

```
ã€å¾“æ¥ã®ãƒ¢ãƒãƒªã‚¹ã€‘
  Web ã‚µãƒ¼ãƒ:  3 å° Ã— 1 IP = 3 IP
  AP ã‚µãƒ¼ãƒ:   3 å° Ã— 1 IP = 3 IP
  DB ã‚µãƒ¼ãƒ:   2 å° Ã— 1 IP = 2 IP
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  åˆè¨ˆ:        8 IP ã‚¢ãƒ‰ãƒ¬ã‚¹

ã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆKubernetesï¼‰ã€‘
  èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ Pod:     10 å€‹ Ã— 1 IP = 10 IP
  å•†å“ã‚µãƒ¼ãƒ“ã‚¹ Pod:     20 å€‹ Ã— 1 IP = 20 IP
  æ³¨æ–‡ã‚µãƒ¼ãƒ“ã‚¹ Pod:     30 å€‹ Ã— 1 IP = 30 IP
  æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹ Pod:     10 å€‹ Ã— 1 IP = 10 IP
  é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ Pod:     10 å€‹ Ã— 1 IP = 10 IP
  ... ä»– 50 ã‚µãƒ¼ãƒ“ã‚¹ ...
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  åˆè¨ˆ:        1000+ IP ã‚¢ãƒ‰ãƒ¬ã‚¹

  ã•ã‚‰ã«ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒ«æ™‚ã¯ 2ã€œ3 å€ã«å¢—åŠ ï¼
```

Kubernetes ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ Pod CIDR ã¯ `/16`ï¼ˆ65,536 ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã§ã™ãŒã€å¤§è¦æ¨¡ã‚¯ãƒ©ã‚¹ã‚¿ã§ã¯ä¸è¶³ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚·ãƒŠãƒªã‚ª 3: IoT / ã‚¹ãƒãƒ¼ãƒˆå·¥å ´

è£½é€ æ¥­ã§ã¯ã€å·¥å ´ã®ã‚¹ãƒãƒ¼ãƒˆåŒ–ã«ä¼´ã„ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã•ã‚Œã‚‹ãƒ‡ãƒã‚¤ã‚¹ãŒçˆ†ç™ºçš„ã«å¢—åŠ ã—ã¦ã„ã¾ã™ã€‚

```
ã€ã‚¹ãƒãƒ¼ãƒˆå·¥å ´ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ‡ãƒã‚¤ã‚¹ã€‘
  æ¸©åº¦ãƒ»æ¹¿åº¦ã‚»ãƒ³ã‚µãƒ¼:  5,000 å°
  æŒ¯å‹•ã‚»ãƒ³ã‚µãƒ¼:        3,000 å°
  ç”»åƒæ¤œæŸ»ã‚«ãƒ¡ãƒ©:        500 å°
  PLCï¼ˆåˆ¶å¾¡è£…ç½®ï¼‰:       500 å°
  ç”£æ¥­ç”¨ãƒ­ãƒœãƒƒãƒˆ:        100 å°
  AGVï¼ˆç„¡äººæ¬é€è»Šï¼‰:      50 å°
  ä½œæ¥­è€…ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ:      300 å°
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  åˆè¨ˆ:               9,450 IP ã‚¢ãƒ‰ãƒ¬ã‚¹

  å°†æ¥ã®æ‹¡å¼µï¼ˆ+å·¥å ´å¢—è¨­ï¼‰ã‚’è€ƒæ…®ã™ã‚‹ã¨...
  /16ï¼ˆ65,536 ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ã§ã‚‚å¿ƒè¨±ãªã„
```

## ã€Œå°†æ¥ã¸ã®å‚™ãˆã€ã¨ã—ã¦ã® Dual Stack

IPv6 ã¯**å³åŠ¹æ€§ã®ã‚ã‚‹è§£æ±ºç­–ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚ã—ã‹ã—ã€ä»¥ä¸‹ã®ç†ç”±ã‹ã‚‰ã€Œå°†æ¥ã¸ã®å‚™ãˆã€ã¨ã—ã¦å­¦ã‚“ã§ãŠãä¾¡å€¤ãŒã‚ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

### IPv6 ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã¯ã©ã‚Œãã‚‰ã„åºƒã„ï¼Ÿ

```
IPv4: 2^32  = ç´„ 43 å„„ï¼ˆ4.3 Ã— 10^9ï¼‰
IPv6: 2^128 = ç´„ 340 æ¾—ï¼ˆ3.4 Ã— 10^38ï¼‰

æ¯”è¼ƒã™ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹æ•° Ã· IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹æ•° = ç´„ 7.9 Ã— 10^28

ã“ã‚Œã¯ã©ã‚Œãã‚‰ã„ã®æ•°ã‹ã¨ã„ã†ã¨...
- åœ°çƒä¸Šã®ã™ã¹ã¦ã®ç ‚ç²’ï¼ˆç´„ 10^18ï¼‰ã« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã¦ã‚‚ä½™ã‚‹
- å¤ªé™½ç³»ã®ã™ã¹ã¦ã®åŸå­ã« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãƒ¬ãƒ™ãƒ«
```

### ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®å¯¾å¿œçŠ¶æ³

| ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ | IPv6 å¯¾å¿œ | å¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹                        | å‚™è€ƒ                                      |
| ------------ | --------- | ----------------------------------- | ----------------------------------------- |
| **AWS**      | âœ… å……å®Ÿ    | VPCã€ELBã€CloudFrontã€S3ã€EC2 ãªã©  | IPv6-only ã‚µãƒ–ãƒãƒƒãƒˆã‚‚ã‚µãƒãƒ¼ãƒˆ            |
| **GCP**      | âœ… å……å®Ÿ    | VPCã€Cloud Load Balancingã€GCE ãªã© | Dual Stack ãŒæ¨™æº–                         |
| **Azure**    | âš ï¸ ä¸€éƒ¨    | VNetã€NSGã€Load Balancer            | **Azure Firewall ãŒéå¯¾å¿œ**ï¼ˆé‡å¤§ãªåˆ¶ç´„ï¼‰ |

### ãƒ¢ãƒã‚¤ãƒ«ãƒ»IoT ã®å‹•å‘

æ—¥æœ¬ã®æºå¸¯ã‚­ãƒ£ãƒªã‚¢ã¯ã€ã™ã§ã« IPv6 ã¸ã®ç§»è¡Œã‚’å®Œäº†ã—ã¦ã„ã¾ã™ã€‚

| ã‚­ãƒ£ãƒªã‚¢     | IPv6 å¯¾å¿œçŠ¶æ³                                 |
| ------------ | --------------------------------------------- |
| NTT ãƒ‰ã‚³ãƒ¢   | IPv6 ã‚·ãƒ³ã‚°ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆIPv4 ã¯ MAP-E ã§å¤‰æ›ï¼‰ |
| au (KDDI)    | IPv6 ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ãƒƒã‚¯                         |
| ã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ | IPv6 ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ãƒƒã‚¯                         |
| æ¥½å¤©ãƒ¢ãƒã‚¤ãƒ« | IPv6 ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ãƒƒã‚¯                         |

ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ Web ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€å®Ÿã¯ IPv6 ã§é€šä¿¡ã—ã¦ã„ã‚‹ã“ã¨ãŒå¤šã„ã®ã§ã™ã€‚

> **Dual Stack ã¨ã¯ï¼Ÿ**
> 1 ã¤ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã« IPv4 ã¨ IPv6 ã®**ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’å‰²ã‚Šå½“ã¦ã‚‹æ§‹æˆã®ã“ã¨ã§ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€IPv4 ã§ã‚‚ IPv6 ã§ã‚‚é€šä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```
ã€Dual Stack æ§‹æˆã®ã‚µãƒ¼ãƒä¾‹ã€‘
  eth0:
    IPv4: 192.168.1.10/24
    IPv6: 2001:db8::10/64

ã“ã®å ´åˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ IPv4 ã§ã‚‚ IPv6 ã§ã‚‚
ã“ã®ã‚µãƒ¼ãƒã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã€Dual Stack ã®ãƒ¡ãƒªãƒƒãƒˆã€‘
  - IPv4 ã—ã‹å¯¾å¿œã—ã¦ã„ãªã„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ IPv4 ã§æ¥ç¶š
  - IPv6 å¯¾å¿œã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ IPv6 ã§æ¥ç¶šï¼ˆé«˜é€Ÿãƒ»åŠ¹ç‡çš„ï¼‰
  - æ®µéšçš„ãª IPv6 ç§»è¡ŒãŒå¯èƒ½
```

---

# IPv6 ã®åŸºç¤ï¼ˆæœ€å°é™ï¼‰

ã“ã“ã§ã¯ã€ãƒãƒ³ã‚ºã‚ªãƒ³ã«å¿…è¦ãªæœ€ä½é™ã®çŸ¥è­˜ã‚’è§£èª¬ã„ãŸã—ã¾ã™ã€‚IPv6 ã‚’åˆã‚ã¦å­¦ã¶æ–¹ã«ã‚‚ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã€IPv4 ã¨ã®æ¯”è¼ƒã‚’äº¤ãˆãªãŒã‚‰èª¬æ˜ã—ã¾ã™ã€‚

## IPv4 ã¨ IPv6 ã®é•ã„

ã¾ãšã€IPv4 ã¨ IPv6 ã®ä¸»ãªé•ã„ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

| é …ç›®                 | IPv4                  | IPv6                 | è£œè¶³                    |
| -------------------- | --------------------- | -------------------- | ----------------------- |
| **ã‚¢ãƒ‰ãƒ¬ã‚¹é•·**       | 32 ãƒ“ãƒƒãƒˆ             | 128 ãƒ“ãƒƒãƒˆ           | IPv6 ã¯ 4 å€ã®é•·ã•      |
| **è¡¨è¨˜ä¾‹**           | `192.168.1.1`         | `2001:db8::1`        | IPv6 ã¯ 16 é€²æ•°         |
| **ã‚¢ãƒ‰ãƒ¬ã‚¹æ•°**       | ç´„ 43 å„„              | ç´„ 340 æ¾—ï¼ˆ10^38ï¼‰   | äº‹å®Ÿä¸Šç„¡é™              |
| **NAT**              | å¿…è¦                  | ä¸è¦ï¼ˆåŸå‰‡ï¼‰         | End-to-End é€šä¿¡ãŒå¯èƒ½ã« |
| **è‡ªå‹•è¨­å®š**         | DHCP                  | SLAAC / DHCPv6       | IPv6 ã¯è¨­å®šä¸è¦ã‚‚å¯     |
| **ãƒ˜ãƒƒãƒ€é•·**         | å¯å¤‰ï¼ˆ20ã€œ60 ãƒã‚¤ãƒˆï¼‰ | å›ºå®šï¼ˆ40 ãƒã‚¤ãƒˆï¼‰    | å‡¦ç†ãŒé«˜é€ŸåŒ–            |
| **ãƒã‚§ãƒƒã‚¯ã‚µãƒ **     | ã‚ã‚Š                  | ãªã—ï¼ˆä¸Šä½å±¤ã§å‡¦ç†ï¼‰ | å‡¦ç†ãŒé«˜é€ŸåŒ–            |
| **ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ** | ã‚ã‚Š                  | **ãªã—**             | ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆã§ä»£æ›¿    |
| **ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆ**     | ãƒ«ãƒ¼ã‚¿ã§ã‚‚å¯èƒ½        | é€ä¿¡å…ƒã®ã¿           | åŠ¹ç‡çš„ãªãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°    |

> **ãƒã‚¤ãƒ³ãƒˆ: NAT ãŒä¸è¦ã«ãªã‚‹ï¼Ÿ**
> IPv4 ã§ã¯ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã™ã‚‹ãŸã‚ã« NATï¼ˆNetwork Address Translationï¼‰ãŒå¿…è¦ã§ã—ãŸã€‚ã—ã‹ã— IPv6 ã§ã¯ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ãŒååˆ†ã«åºƒã„ãŸã‚ã€ã™ã¹ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€End-to-End ã§ã®ç›´æ¥é€šä¿¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

## IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã®èª­ã¿æ–¹

IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ 16 é€²æ•°ã§è¡¨è¨˜ã•ã‚Œã€`:` ã§ 8 ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ã«åŒºåˆ‡ã‚‰ã‚Œã¾ã™ã€‚å„ãƒ–ãƒ­ãƒƒã‚¯ã¯ 16 ãƒ“ãƒƒãƒˆï¼ˆ4 æ¡ã® 16 é€²æ•°ï¼‰ã§ã™ã€‚

### å®Œå…¨è¡¨è¨˜ã¨çœç•¥è¡¨è¨˜

```
ã€å®Œå…¨è¡¨è¨˜ã€‘
2001:0db8:0000:0000:0000:0000:0000:0001
 â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“  â†“â†“â†“â†“
 16bit 16bit 16bit 16bit 16bit 16bit 16bit 16bit = 128bit

ã€çœç•¥è¡¨è¨˜ã€‘
2001:db8::1

ã€çœç•¥ãƒ«ãƒ¼ãƒ«ã€‘
1. å„ãƒ–ãƒ­ãƒƒã‚¯ã®å…ˆé ­ã® 0 ã¯çœç•¥å¯èƒ½
   0db8 â†’ db8
   0000 â†’ 0
   0001 â†’ 1

2. é€£ç¶šã™ã‚‹ :0000: ã¯ :: ã§ 1 å›ã ã‘çœç•¥å¯èƒ½
   :0000:0000:0000:0000:0000: â†’ ::
```

### ã‚ˆãã‚ã‚‹é–“é•ã„

```
ã€NGã€‘é€£ç¶šã™ã‚‹ 0 ã‚’ 2 å›çœç•¥ã—ã¦ã¯ã„ã‘ãªã„
2001::1234::5678  â† ã©ã“ã«ä½•å€‹ã® 0 ãŒã‚ã‚‹ã‹ã‚ã‹ã‚‰ãªããªã‚‹

ã€OKã€‘çœç•¥ã¯ 1 ç®‡æ‰€ã ã‘
2001::1234:0:0:5678  â† :: ã¯ 1 å›ã ã‘ä½¿ç”¨
```

### å®Ÿéš›ã®ä¾‹

```
ã€ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‘
IPv4: 127.0.0.1
IPv6: ::1  â† 0000:0000:0000:0000:0000:0000:0000:0001 ã®çœç•¥å½¢

ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”¨ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆä¾‹ç¤ºç”¨ï¼‰ã€‘
IPv6: 2001:db8::/32  â† RFC 3849 ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ä¾‹ç¤ºç”¨ã‚¢ãƒ‰ãƒ¬ã‚¹
                       (å®Ÿéš›ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ä½¿ç”¨ã—ãªã„)
```

## ã‚µãƒ–ãƒãƒƒãƒˆã¨ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹

IPv4 ã§ã¯ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯ï¼ˆä¾‹: `/24`ï¼‰ã‚’ä½¿ã„ã¾ã™ãŒã€IPv6 ã§ã‚‚åŒæ§˜ã«ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹é•·ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```
ã€IPv4 ã®ä¾‹ã€‘
192.168.1.0/24
  â”œâ”€â”€ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨: 192.168.1ï¼ˆ24 ãƒ“ãƒƒãƒˆï¼‰
  â””â”€â”€ ãƒ›ã‚¹ãƒˆéƒ¨:       .0ã€œ.255ï¼ˆ8 ãƒ“ãƒƒãƒˆ = 256 ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰

ã€IPv6 ã®ä¾‹ã€‘
fd00:dead:beef::/64
  â”œâ”€â”€ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯éƒ¨: fd00:dead:beef:0000ï¼ˆ64 ãƒ“ãƒƒãƒˆï¼‰
  â””â”€â”€ ãƒ›ã‚¹ãƒˆéƒ¨:       ::0000:0000:0000:0001ã€œï¼ˆ64 ãƒ“ãƒƒãƒˆ = ç´„ 1844 äº¬ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
```

> **ãªãœ /64 ãŒæ¨™æº–ãªã®ã‹ï¼Ÿ**
> IPv6 ã§ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ IDï¼ˆãƒ›ã‚¹ãƒˆéƒ¨ï¼‰ã« 64 ãƒ“ãƒƒãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹ã®ãŒæ¨™æº–ã§ã™ã€‚ã“ã‚Œã¯ SLAACï¼ˆStateless Address Autoconfigurationï¼‰ã§ MAC ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã«ç”±æ¥ã—ã¦ã„ã¾ã™ã€‚

## IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¨®é¡

IPv6 ã«ã¯ç”¨é€”åˆ¥ã«è¤‡æ•°ã®ç¨®é¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚IPv4 ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç›¸å½“ã™ã‚‹ã‚‚ã®ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚

| ç¨®é¡                              | ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹                    | ç”¨é€”                         | IPv4 ã§ä¾‹ãˆã‚‹ã¨                |
| --------------------------------- | --------------------------------- | ---------------------------- | ------------------------------ |
| **ULA**ï¼ˆUnique Local Addressï¼‰   | `fc00::/7`ï¼ˆå®Ÿç”¨ä¸Šã¯ `fd00::/8`ï¼‰ | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯     | `10.0.0.0/8`, `192.168.0.0/16` |
| **GUA**ï¼ˆGlobal Unicast Addressï¼‰ | `2000::/3`                        | ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆï¼‰ | ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹         |
| **LLA**ï¼ˆLink-Local Addressï¼‰     | `fe80::/10`                       | åŒä¸€ãƒªãƒ³ã‚¯å†…ã®ã¿             | `169.254.0.0/16`ï¼ˆAPIPAï¼‰      |
| **ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆ**                | `ff00::/8`                        | ä¸€å¯¾å¤šé€šä¿¡                   | `224.0.0.0/4`                  |

### ULAï¼ˆUnique Local Addressï¼‰ã®è©³ç´°

ä»Šå›ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§ã¯ **ULA** ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ULA ã¯ä»¥ä¸‹ã®æ§‹é€ ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

```
fd00:dead:beef:0000:0000:0000:0000:0010
â”‚ â”‚         â”‚    â”‚                    â”‚
â”‚ â”‚         â”‚    â”‚                    â””â”€â”€ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ID
â”‚ â”‚         â”‚    â””â”€â”€ ã‚µãƒ–ãƒãƒƒãƒˆ ID
â”‚ â”‚         â””â”€â”€ ã‚°ãƒ­ãƒ¼ãƒãƒ« IDï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆï¼‰
â”‚ â””â”€â”€ L ãƒ“ãƒƒãƒˆï¼ˆ1 = ãƒ­ãƒ¼ã‚«ãƒ«å‰²ã‚Šå½“ã¦ï¼‰
â””â”€â”€ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼ˆfd = ULAï¼‰

ã€fd00:dead:beef::/64 ã®æ„å‘³ã€‘
- fd: ULAï¼ˆãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆï¼‰ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™
- 00:dead:beef: ã‚°ãƒ­ãƒ¼ãƒãƒ« IDï¼ˆçµ„ç¹”ã‚’è­˜åˆ¥ï¼‰
- /64: ã‚µãƒ–ãƒãƒƒãƒˆãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹é•·
```

> **ãªãœ dead:beef ã‚’ä½¿ã†ã®ã‹ï¼Ÿ**
> `dead:beef` ã¯ 16 é€²æ•°ã¨ã—ã¦æœ‰åŠ¹ã§ã€è¦šãˆã‚„ã™ã„ãŸã‚ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã‚ˆãä½¿ã‚ã‚Œã¾ã™ã€‚å®Ÿéš›ã«ã¯ã€ULA ã®ã‚°ãƒ­ãƒ¼ãƒãƒ« ID ã¯ [RFC 4193](https://datatracker.ietf.org/doc/html/rfc4193) ã«å¾“ã£ã¦ãƒ©ãƒ³ãƒ€ãƒ ã«ç”Ÿæˆã™ã¹ãã§ã™ã€‚

### LLAï¼ˆLink-Local Addressï¼‰ã«ã¤ã„ã¦

LLA ã¯ãƒ«ãƒ¼ã‚¿ã‚’è¶…ãˆã¦é€šä¿¡ã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ãŒã€éå¸¸ã«é‡è¦ãªå½¹å‰²ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

```
ã€LLA ã®ç”¨é€”ã€‘
- éš£æ¥ãƒãƒ¼ãƒ‰ã®ç™ºè¦‹ï¼ˆNeighbor Discovery Protocolï¼‰
- ãƒ«ãƒ¼ã‚¿ã®ç™ºè¦‹ï¼ˆRouter Advertisementï¼‰
- DHCPv6 ã‚µãƒ¼ãƒã¨ã®é€šä¿¡
- IPv6 è‡ªå‹•è¨­å®šã®åŸºç›¤

ã€ç‰¹å¾´ã€‘
- ã™ã¹ã¦ã® IPv6 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«è‡ªå‹•ã§å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
- è¨­å®šãªã—ã§åŒä¸€ãƒªãƒ³ã‚¯å†…ã®ä»–ã®ãƒãƒ¼ãƒ‰ã¨é€šä¿¡å¯èƒ½
- fe80:: ã§å§‹ã¾ã‚‹
```

## SLAACï¼ˆè‡ªå‹•ã‚¢ãƒ‰ãƒ¬ã‚¹è¨­å®šï¼‰

IPv6 ã®å¤§ããªç‰¹å¾´ã®ä¸€ã¤ãŒã€DHCP ã‚µãƒ¼ãƒãªã—ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è‡ªå‹•è¨­å®šã§ãã‚‹ã“ã¨ã§ã™ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant Host as ãƒ›ã‚¹ãƒˆ
    participant Router as ãƒ«ãƒ¼ã‚¿

    Note over Host: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹èµ·å‹•
    Host->>Host: LLA ã‚’è‡ªå‹•ç”Ÿæˆ<br/>(fe80::...)

    Host->>Router: Router Solicitation<br/>(ãƒ«ãƒ¼ã‚¿ã‚’æ¢ã™)
    activate Router
    Router-->>Host: Router Advertisement<br/>(ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹: 2001:db8::/64)
    deactivate Router

    Note over Host: ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ + ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ ID<br/>= ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆ

    Host->>Host: GUA ã‚’è¨­å®š<br/>(2001:db8::xxxx:xxxx)
```

> **SLAAC vs DHCPv6**
> - **SLAAC**: ãƒ«ãƒ¼ã‚¿ã‹ã‚‰ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å—ã‘å–ã‚Šã€ãƒ›ã‚¹ãƒˆãŒè‡ªåˆ†ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç”Ÿæˆ
> - **DHCPv6**: IPv4 ã® DHCP ã¨åŒæ§˜ã«ã€ã‚µãƒ¼ãƒã‹ã‚‰ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å‰²ã‚Šå½“ã¦
> - ä¸¡æ–¹ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼ˆSLAAC ã§ã‚¢ãƒ‰ãƒ¬ã‚¹ã€DHCPv6 ã§ DNS æƒ…å ±ãªã©ï¼‰

## ICMPv6 ã¨ Neighbor Discovery

IPv6 ã§ã¯ã€IPv4 ã® ARPï¼ˆAddress Resolution Protocolï¼‰ã«ç›¸å½“ã™ã‚‹æ©Ÿèƒ½ãŒ ICMPv6 ã®ä¸€éƒ¨ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚’ **Neighbor Discovery Protocolï¼ˆNDPï¼‰** ã¨å‘¼ã³ã¾ã™ã€‚

| IPv4                  | IPv6ï¼ˆNDPï¼‰                                    | æ©Ÿèƒ½                  |
| --------------------- | ---------------------------------------------- | --------------------- |
| ARP                   | Neighbor Solicitation / Neighbor Advertisement | IP â†’ MAC ã‚¢ãƒ‰ãƒ¬ã‚¹è§£æ±º |
| ICMP Router Discovery | Router Solicitation / Router Advertisement     | ãƒ«ãƒ¼ã‚¿ã®ç™ºè¦‹          |
| ICMP Redirect         | Redirect                                       | ã‚ˆã‚Šè‰¯ã„çµŒè·¯ã®é€šçŸ¥    |
| ãªã—                  | Duplicate Address Detectionï¼ˆDADï¼‰             | ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡ã®æ¤œå‡º    |

> **ãªãœ ARP ãŒãªããªã£ãŸã®ã‹ï¼Ÿ**
> IPv4 ã® ARP ã¯ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ãŒã€IPv6 ã§ã¯ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãŒå»ƒæ­¢ã•ã‚Œã¾ã—ãŸã€‚ä»£ã‚ã‚Šã«ã€åŠ¹ç‡çš„ãªãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ NDP ãŒå°å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ä»Šå›ä½¿ç”¨ã™ã‚‹ã‚¢ãƒ‰ãƒ¬ã‚¹

ã“ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§ã¯ã€ä»¥ä¸‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

| ã‚³ãƒ³ãƒ†ãƒŠ        | IPv4        | IPv6ï¼ˆULAï¼‰        |
| --------------- | ----------- | ------------------ |
| web (nginx)     | 172.30.0.10 | fd00:dead:beef::10 |
| dns (CoreDNS)   | 172.30.0.53 | fd00:dead:beef::53 |
| client (Alpine) | 172.30.0.20 | fd00:dead:beef::20 |

```
ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆã€‘
IPv4 ã‚µãƒ–ãƒãƒƒãƒˆ: 172.30.0.0/24   â†’ 254 å€‹ã®ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
IPv6 ã‚µãƒ–ãƒãƒƒãƒˆ: fd00:dead:beef::/64 â†’ ç´„ 1844 äº¬å€‹ã®ãƒ›ã‚¹ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹
```

---

# ãƒãƒ³ã‚ºã‚ªãƒ³ç’°å¢ƒã®æº–å‚™

ã“ã“ã‹ã‚‰ã¯ã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦ IPv6 Dual Stack ã‚’ä½“é¨“ã—ã¦ã„ãã¾ã™ã€‚Docker ã‚’ä½¿ã£ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«å®Œå…¨ãª Dual Stack ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

## å¿…è¦ãªã‚‚ã®

| é …ç›®                | å¿…é ˆ/æ¨å¥¨ | èª¬æ˜                             |
| ------------------- | --------- | -------------------------------- |
| **Rancher Desktop** | æ¨å¥¨      | ç„¡æ–™ã§å•†ç”¨åˆ©ç”¨å¯èƒ½ãª Docker ç’°å¢ƒ |
| Docker Desktop      | ä»£æ›¿å¯    | æœ‰æ–™ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒå¿…è¦ãªå ´åˆã‚ã‚Š   |
| Docker Compose      | å¿…é ˆ      | ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³     |
| ã‚¿ãƒ¼ãƒŸãƒŠãƒ«          | å¿…é ˆ      | bash ã¾ãŸã¯ zsh                  |
| Git                 | å¿…é ˆ      | ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³ç”¨           |

> **ãªãœ Rancher Desktop ã‚’æ¨å¥¨ã™ã‚‹ã®ã‹ï¼Ÿ**
> - **ç„¡æ–™ã§å•†ç”¨åˆ©ç”¨å¯èƒ½**: Docker Desktop ã¯å¾“æ¥­å“¡ 250 åä»¥ä¸Šã¾ãŸã¯å¹´é–“å£²ä¸Š 1,000 ä¸‡ãƒ‰ãƒ«ä»¥ä¸Šã®ä¼æ¥­ã§æœ‰æ–™
> - **ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹**: å®Œå…¨ã«ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§é–‹ç™ºã•ã‚Œã¦ã„ã‚‹
> - **Docker äº’æ›**: `dockerd (moby)` ã‚’ Container Engine ã¨ã—ã¦é¸æŠã™ã‚Œã° Docker ã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹
> - **Kubernetes å†…è”µ**: å¿…è¦ã«å¿œã˜ã¦ K8s ç’°å¢ƒã‚‚åˆ©ç”¨å¯èƒ½

### Rancher Desktop ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

åˆã‚ã¦ Rancher Desktop ã‚’ä½¿ç”¨ã•ã‚Œã‚‹æ–¹ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã§è¨­å®šã—ã¦ãã ã•ã„ã€‚

```
ã€Rancher Desktop åˆæœŸè¨­å®šã€‘

1. Rancher Desktop ã‚’èµ·å‹•

2. Preferencesï¼ˆè¨­å®šï¼‰ã‚’é–‹ã
   - macOS: ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ â†’ Rancher Desktop â†’ Preferences
   - Windows: ã‚·ã‚¹ãƒ†ãƒ ãƒˆãƒ¬ã‚¤ â†’ Rancher Desktop â†’ Settings

3. Container Engine ã‚’è¨­å®š
   - Container Engine: dockerd (moby) ã‚’é¸æŠ  â† é‡è¦ï¼
   - containerd ã‚’é¸æŠã™ã‚‹ã¨ docker ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã¾ã›ã‚“

4. è¨­å®šã‚’ä¿å­˜ã—ã¦å†èµ·å‹•
```

### å‹•ä½œç¢ºèª

Rancher Desktopï¼ˆã¾ãŸã¯ Docker Desktopï¼‰ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
# Docker ãŒä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèª
docker --version
# å‡ºåŠ›ä¾‹: Docker version 24.0.7, build afdd53b

# Docker Compose ãŒä½¿ãˆã‚‹ã“ã¨ã‚’ç¢ºèª
docker compose version
# å‡ºåŠ›ä¾‹: Docker Compose version v2.23.0

# Docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒå‹•ä½œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
docker info | grep "Server Version"
# å‡ºåŠ›ä¾‹: Server Version: 24.0.7
```

## ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

ãƒãƒ³ã‚ºã‚ªãƒ³ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’ GitHub ã§å…¬é–‹ã—ã¦ãŠã‚Šã¾ã™ã€‚

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/sbk0716/rd-dualstack-lab.git

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd rd-dualstack-lab

# ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’ç¢ºèª
ls -la
```

https://github.com/sbk0716/rd-dualstack-lab

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã®æ§‹æˆã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã‚’ç†è§£ã—ã¦ãŠãã¨ã€å®Ÿé¨“ãŒã‚¹ãƒ ãƒ¼ã‚ºã«é€²ã¿ã¾ã™ã€‚

```
rd-dualstack-lab/
â”œâ”€â”€ README.md           # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª¬æ˜
â”œâ”€â”€ article.md          # ã“ã®è¨˜äº‹ã®ã‚½ãƒ¼ã‚¹ï¼ˆZenn ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ï¼‰
â”œâ”€â”€ compose.yaml        # Docker Compose è¨­å®šï¼ˆDual Stack ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å®šç¾©ï¼‰
â”œâ”€â”€ Corefile            # CoreDNS è¨­å®šï¼ˆA/AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰å®šç¾©ï¼‰
â”œâ”€â”€ start.sh            # èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆç’°å¢ƒæ§‹ç¯‰ + ç¢ºèªï¼‰
â”œâ”€â”€ stop.sh             # åœæ­¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼‰
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ test-report.md  # ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ
â””â”€â”€ scripts/
    â”œâ”€â”€ ds_client.py        # Python ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
    â”œâ”€â”€ setup-client.sh     # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    â”œâ”€â”€ test-connectivity.sh # æ¥ç¶šãƒ†ã‚¹ãƒˆ
    â””â”€â”€ test-fallback.sh    # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
```

### å„ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°

| ãƒ•ã‚¡ã‚¤ãƒ«         | å½¹å‰²                                                           | é‡è¦åº¦ |
| ---------------- | -------------------------------------------------------------- | ------ |
| **compose.yaml** | Dual Stack ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ 3 ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’å®šç¾©                 | â­â­â­    |
| **Corefile**     | DNS ã‚µãƒ¼ãƒï¼ˆCoreDNSï¼‰ã®è¨­å®šã€‚A/AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©             | â­â­â­    |
| **start.sh**     | ç’°å¢ƒèµ·å‹• + IPv6 æœ‰åŠ¹ç¢ºèª + IP ã‚¢ãƒ‰ãƒ¬ã‚¹è¡¨ç¤º                     | â­â­     |
| **stop.sh**      | ã‚³ãƒ³ãƒ†ãƒŠãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—             | â­â­     |
| **ds_client.py** | IPv6 â†’ IPv4 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è©³ç´°ã«è¦³å¯Ÿã§ãã‚‹ Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | â­â­     |

## compose.yaml ã®è§£èª¬

Dual Stack ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ãŸã‚ã® Docker Compose è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚å„è¨­å®šé …ç›®ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã„ãŸã—ã¾ã™ã€‚

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šï¼ˆæœ€é‡è¦ï¼‰

```yaml
networks:
  dsnet:
    # ãƒ–ãƒªãƒƒã‚¸ãƒ‰ãƒ©ã‚¤ãƒã‚’ä½¿ç”¨ï¼ˆDocker ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
    driver: bridge
    # â˜…é‡è¦â˜… IPv6 ã‚’æœ‰åŠ¹åŒ–ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ falseï¼‰
    enable_ipv6: true
    # IPAM: IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‰²ã‚Šå½“ã¦è¨­å®š
    ipam:
      config:
        # IPv4 ã‚µãƒ–ãƒãƒƒãƒˆ
        - subnet: 172.30.0.0/24
        # IPv6 ã‚µãƒ–ãƒãƒƒãƒˆï¼ˆULA = ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IPv6ï¼‰
        - subnet: fd00:dead:beef::/64
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `enable_ipv6: true` ãŒæœ€ã‚‚é‡è¦ãªè¨­å®šã§ã™ã€‚ã“ã‚ŒãŒãªã„ã¨ IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¾ã›ã‚“
- `fd00::/8` ã¯ ULAï¼ˆUnique Local Addressï¼‰ã¨å‘¼ã°ã‚Œã‚‹ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã§ã™
- `/64` ã¯ IPv6 ã®æ¨™æº–çš„ãªã‚µãƒ–ãƒãƒƒãƒˆã‚µã‚¤ã‚ºã§ã™ï¼ˆ2^64 å€‹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒä½¿ç”¨å¯èƒ½ï¼‰

### Web ã‚µãƒ¼ãƒï¼ˆnginxï¼‰

```yaml
web:
  image: nginx:alpine
  container_name: rd-ds-web
  networks:
    dsnet:
      # IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šå‰²ã‚Šå½“ã¦
      ipv4_address: 172.30.0.10
      ipv6_address: fd00:dead:beef::10
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- 1 ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã« **IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹**ã‚’å‰²ã‚Šå½“ã¦ã¦ã„ã¾ã™
- ã“ã‚ŒãŒ Dual Stack ã®æœ¬è³ªã§ã™

### DNS ã‚µãƒ¼ãƒï¼ˆCoreDNSï¼‰

```yaml
dns:
  image: coredns/coredns:1.11.1
  container_name: rd-ds-dns
  command: ["-conf", "/Corefile"]
  volumes:
    - ./Corefile:/Corefile:ro
  networks:
    dsnet:
      ipv4_address: 172.30.0.53
      ipv6_address: fd00:dead:beef::53
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰ã®ä¸¡æ–¹ã‚’è¿”ã™ DNS ã‚µãƒ¼ãƒã§ã™
- è¨­å®šã¯ `Corefile` ã§å®šç¾©ã—ã¦ã„ã¾ã™

### ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆAlpine Linuxï¼‰

```yaml
client:
  image: alpine:3.20
  container_name: rd-ds-client
  command: ["sh", "-c", "sleep infinity"]
  depends_on:
    - web
    - dns
  dns:
    - 172.30.0.53
  networks:
    dsnet:
      ipv4_address: 172.30.0.20
      ipv6_address: fd00:dead:beef::20
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `sleep infinity` ã§ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ã—ãŸã¾ã¾ã«ã—ã¦ã„ã¾ã™
- `dns: - 172.30.0.53` ã§ CoreDNS ã‚’ DNS ã‚µãƒ¼ãƒã¨ã—ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™
- ã“ã®ã‚³ãƒ³ãƒ†ãƒŠã« `docker exec` ã§å…¥ã£ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™

## Corefileï¼ˆDNS è¨­å®šï¼‰ã®è§£èª¬

CoreDNS ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ä»Šå›ã®ãƒãƒ³ã‚ºã‚ªãƒ³ã§é‡è¦ãª A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```
. {
  log
  errors
  hosts {
    # æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³
    172.30.0.10 dual-ok.local           # A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰
    fd00:dead:beef::10 dual-ok.local    # AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰

    # IPv6 éšœå®³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³
    172.30.0.10 dual-badv6.local        # A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰â†’ æ­£å¸¸
    fd00:dead:beef::9999 dual-badv6.local  # AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰â†’ åˆ°é”ä¸èƒ½ï¼

    fallthrough
  }
  forward . 1.1.1.1 8.8.8.8
}
```

### DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æ§‹æˆ

| ãƒ‰ãƒ¡ã‚¤ãƒ³             | A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ | AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰  | ç”¨é€”                 |
| -------------------- | ------------------ | ---------------------- | -------------------- |
| **dual-ok.local**    | 172.30.0.10 âœ…      | fd00:dead:beef::10 âœ…   | æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ         |
| **dual-badv6.local** | 172.30.0.10 âœ…      | fd00:dead:beef::9999 âŒ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ |

### ãªãœ dual-badv6.local ã‚’ç”¨æ„ã™ã‚‹ã®ã‹ï¼Ÿ

`dual-badv6.local` ã¯æ„å›³çš„ã«**åˆ°é”ä¸èƒ½ãª IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹**ï¼ˆ`::9999`ï¼‰ã‚’è¿”ã—ã¾ã™ã€‚ã“ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ï¼š

1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ DNS ã‹ã‚‰ A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
2. IPv6ï¼ˆ`::9999`ï¼‰ã¸ã®æ¥ç¶šã‚’è©¦ã¿ã‚‹ â†’ **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**
3. IPv4ï¼ˆ`172.30.0.10`ï¼‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ **æˆåŠŸ**

ã“ã®å‹•ä½œã‚’è¦³å¯Ÿã™ã‚‹ã“ã¨ã§ã€Happy Eyeballsï¼ˆIPv6/IPv4 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ã®ä»•çµ„ã¿ã‚’ä½“é¨“ã§ãã¾ã™ã€‚

## ç’°å¢ƒã®æ§‹æˆå›³

ä»Šå›æ§‹ç¯‰ã™ã‚‹ç’°å¢ƒã¯ã€3 ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dsnet (172.30.0.0/24, fd00:dead:beef::/64)             â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  web    â”‚    â”‚  dns    â”‚    â”‚   client    â”‚          â”‚
â”‚  â”‚ (nginx) â”‚    â”‚(CoreDNS)â”‚    â”‚  (alpine)   â”‚          â”‚
â”‚  â”‚         â”‚    â”‚         â”‚    â”‚             â”‚          â”‚
â”‚  â”‚ .0.10   â”‚    â”‚ .0.53   â”‚    â”‚   .0.20     â”‚          â”‚
â”‚  â”‚ ::10    â”‚    â”‚ ::53    â”‚    â”‚   ::20      â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ã‚³ãƒ³ãƒ†ãƒŠ | å½¹å‰²                  | IPv4        | IPv6               |
| -------- | --------------------- | ----------- | ------------------ |
| web      | Web ã‚µãƒ¼ãƒï¼ˆnginxï¼‰   | 172.30.0.10 | fd00:dead:beef::10 |
| dns      | DNS ã‚µãƒ¼ãƒï¼ˆCoreDNSï¼‰ | 172.30.0.53 | fd00:dead:beef::53 |
| client   | ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ    | 172.30.0.20 | fd00:dead:beef::20 |

## èµ·å‹•

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™ã€‚

```bash
./start.sh
```

ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

```
==========================================
Starting Dual Stack Lab...
==========================================

### Starting containers ###
[+] Running 4/4
 âœ” Network rd-dualstack-lab_dsnet  Created
 âœ” Container rd-ds-dns             Started
 âœ” Container rd-ds-web             Started
 âœ” Container rd-ds-client          Started

### Checking network configuration ###

IPv6 is ENABLED on dsnet network

### Container IP addresses ###

web container:
  IPv4: 172.30.0.10
  IPv6: fd00:dead:beef::10
```

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**: `IPv6 is ENABLED` ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

---

# å®Ÿé¨“ 1: IPv4/IPv6 ç–é€šç¢ºèª

æœ€åˆã®å®Ÿé¨“ã§ã¯ã€Dual Stack ç’°å¢ƒã§ **IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã§é€šä¿¡ã§ãã‚‹ã“ã¨** ã‚’ç¢ºèªã—ã¾ã™ã€‚ã“ã‚ŒãŒ Dual Stack ã®æœ€ã‚‚åŸºæœ¬çš„ãªå‹•ä½œã§ã™ã€‚

## ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚‹

ã¾ãšã€ãƒ†ã‚¹ãƒˆç”¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒŠã«ã‚·ã‚§ãƒ«ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```bash
docker exec -it rd-ds-client sh
```

> **docker exec ã¨ã¯ï¼Ÿ**
> å®Ÿè¡Œä¸­ã®ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã® Docker ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚
> - `-i`: æ¨™æº–å…¥åŠ›ã‚’é–‹ã„ãŸã¾ã¾ã«ã™ã‚‹ï¼ˆinteractiveï¼‰
> - `-t`: ç–‘ä¼¼ TTY ã‚’å‰²ã‚Šå½“ã¦ã‚‹ï¼ˆterminalï¼‰
> - `sh`: å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼ˆAlpine Linux ã®ã‚·ã‚§ãƒ«ï¼‰

## å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã€ãƒ†ã‚¹ãƒˆã«å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
apk add --no-cache curl bind-tools iputils python3
```

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸     | å«ã¾ã‚Œã‚‹ã‚³ãƒãƒ³ãƒ‰ | ç”¨é€”                                 |
| -------------- | ---------------- | ------------------------------------ |
| **curl**       | curl             | HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é€ä¿¡                |
| **bind-tools** | dig, nslookup    | DNS ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œ                     |
| **iputils**    | ping, ping6      | ICMP ç–é€šç¢ºèª                        |
| **python3**    | python3          | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ |

## IPv4 ã§ HTTP ã‚¢ã‚¯ã‚»ã‚¹

curl ã‚³ãƒãƒ³ãƒ‰ã§ Web ã‚µãƒ¼ãƒã« IPv4 ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```bash
curl -4 http://172.30.0.10/
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜**:
- `-4`: IPv4 ã®ã¿ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶š

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```html
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
html { color-scheme: light dark; }
body { width: 35em; margin: 0 auto;
font-family: Tahoma, Verdana, Arial, sans-serif; }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>
...
</body>
</html>
```

nginx ã®ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

## IPv6 ã§ HTTP ã‚¢ã‚¯ã‚»ã‚¹

æ¬¡ã«ã€åŒã˜ Web ã‚µãƒ¼ãƒã« IPv6 ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```bash
curl -6 -g http://[fd00:dead:beef::10]/
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜**:
- `-6`: IPv6 ã®ã¿ã‚’ä½¿ç”¨ã—ã¦æ¥ç¶š
- `-g`: URL å†…ã® `[]` ã‚’ã‚°ãƒ­ãƒ–ã¨ã—ã¦è§£é‡ˆã—ãªã„ï¼ˆIPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å«ã‚€ URL ã§å¿…è¦ï¼‰

**IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ URL ã§æŒ‡å®šã™ã‚‹éš›ã®æ³¨æ„ç‚¹**:

```
ã€IPv4 ã®å ´åˆã€‘
http://172.30.0.10/  â† ãã®ã¾ã¾è¨˜è¿°

ã€IPv6 ã®å ´åˆã€‘
http://[fd00:dead:beef::10]/  â† è§’æ‹¬å¼§ [] ã§å›²ã‚€å¿…è¦ãŒã‚ã‚‹

ãªãœ [] ãŒå¿…è¦ãªã®ã‹ï¼Ÿ
IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¯ : ãŒå«ã¾ã‚Œã‚‹ãŸã‚ã€ãƒãƒ¼ãƒˆç•ªå·ã®åŒºåˆ‡ã‚Šæ–‡å­—ã¨åŒºåˆ¥ã§ããªããªã‚‹
ä¾‹: http://2001:db8::1:8080 ã¯ 2001:db8::1 ã®ãƒãƒ¼ãƒˆ 8080 ãªã®ã‹ä¸æ˜
    http://[2001:db8::1]:8080 ãªã‚‰æ˜ç¢º
```

åŒã˜ nginx ã®ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚

## Ping ã§ç¢ºèª

ICMPï¼ˆpingï¼‰ã§ã‚‚ç–é€šç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

### IPv4 ã§ã® ping

```bash
ping -c 2 172.30.0.10
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
PING 172.30.0.10 (172.30.0.10) 56 data bytes
64 bytes from 172.30.0.10: icmp_seq=1 ttl=64 time=0.089 ms
64 bytes from 172.30.0.10: icmp_seq=2 ttl=64 time=0.156 ms

--- 172.30.0.10 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.089/0.122/0.156/0.033 ms
```

### IPv6 ã§ã® ping

```bash
ping -c 2 fd00:dead:beef::10
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
PING fd00:dead:beef::10 (fd00:dead:beef::10) 56 data bytes
64 bytes from fd00:dead:beef::10: icmp_seq=1 ttl=64 time=0.046 ms
64 bytes from fd00:dead:beef::10: icmp_seq=2 ttl=64 time=0.227 ms

--- fd00:dead:beef::10 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.046/0.136/0.227/0.090 ms
```

> **ping ã®çµæœã®èª­ã¿æ–¹**
> - `64 bytes from ...`: ãƒ‘ã‚±ãƒƒãƒˆãŒæ­£å¸¸ã«è¿”ã£ã¦ããŸ
> - `icmp_seq=1`: ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ç•ªå·ï¼ˆ1 ã‹ã‚‰é †ç•ªã«å¢—åŠ ï¼‰
> - `ttl=64`: Time To Liveï¼ˆãƒ‘ã‚±ãƒƒãƒˆãŒé€šéã§ãã‚‹ãƒ›ãƒƒãƒ—æ•°ï¼‰
> - `time=0.046 ms`: å¾€å¾©æ™‚é–“ï¼ˆRTT: Round Trip Timeï¼‰
> - `0% packet loss`: ãƒ‘ã‚±ãƒƒãƒˆãƒ­ã‚¹ãªã—ï¼ˆã™ã¹ã¦æ­£å¸¸ã«é€šä¿¡ï¼‰

## ã‚³ãƒ³ãƒ†ãƒŠã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª

ã‚³ãƒ³ãƒ†ãƒŠå†…ã‹ã‚‰ã€è‡ªåˆ†è‡ªèº«ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```bash
ip addr show eth0
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP
    link/ether 02:42:ac:1e:00:14 brd ff:ff:ff:ff:ff:ff
    inet 172.30.0.20/24 brd 172.30.0.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fd00:dead:beef::20/64 scope global nodad
       valid_lft forever preferred_lft forever
    inet6 fe80::42:acff:fe1e:14/64 scope link
       valid_lft forever preferred_lft forever
```

**å‡ºåŠ›ã®èª­ã¿æ–¹**:
- `inet 172.30.0.20/24`: IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹
- `inet6 fd00:dead:beef::20/64 scope global`: IPv6 ã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼ˆULAï¼‰ã‚¢ãƒ‰ãƒ¬ã‚¹
- `inet6 fe80::... scope link`: IPv6 ãƒªãƒ³ã‚¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰

1 ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆeth0ï¼‰ã« **IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹**ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒ Dual Stack ã§ã™ã€‚

## ã“ã“ã¾ã§ã®å­¦ã³

ã“ã®å®Ÿé¨“ã§ç¢ºèªã§ããŸã“ã¨ï¼š

| ç¢ºèªé …ç›®    | IPv4                          | IPv6                                   | çµæœ               |
| ----------- | ----------------------------- | -------------------------------------- | ------------------ |
| HTTP é€šä¿¡   | `curl -4 http://172.30.0.10/` | `curl -6 http://[fd00:dead:beef::10]/` | âœ… ä¸¡æ–¹æˆåŠŸ         |
| ICMP é€šä¿¡   | `ping 172.30.0.10`            | `ping fd00:dead:beef::10`              | âœ… ä¸¡æ–¹æˆåŠŸ         |
| IP ã‚¢ãƒ‰ãƒ¬ã‚¹ | 172.30.0.20                   | fd00:dead:beef::20                     | âœ… ä¸¡æ–¹å‰²ã‚Šå½“ã¦æ¸ˆã¿ |

**ãƒã‚¤ãƒ³ãƒˆ**:
- 1 ã¤ã® Web ã‚µãƒ¼ãƒã« **IPv4 ã§ã‚‚ IPv6 ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹**
- 1 ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠã« **IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹**
- ã“ã‚ŒãŒ **Dual Stack** ã®åŸºæœ¬çš„ãªå‹•ä½œ

## Dual Stack ç–é€šç¢ºèªãƒ•ãƒ­ãƒ¼

ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ Web ã‚µãƒ¼ãƒã¸ã® IPv4/IPv6 é€šä¿¡ã®æµã‚Œã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant Client as client<br/>(172.30.0.20)<br/>(fd00:dead:beef::20)
    participant Web as web<br/>(172.30.0.10)<br/>(fd00:dead:beef::10)

    Note over Client,Web: IPv4 ã§ã®é€šä¿¡
    Client->>Web: HTTP GET (IPv4: 172.30.0.10)
    activate Web
    Web-->>Client: HTTP 200 OK
    deactivate Web

    Note over Client,Web: IPv6 ã§ã®é€šä¿¡
    Client->>Web: HTTP GET (IPv6: fd00:dead:beef::10)
    activate Web
    Web-->>Client: HTTP 200 OK
    deactivate Web

    Note over Client,Web: åŒã˜ã‚µãƒ¼ãƒã« IPv4/IPv6<br/>ã©ã¡ã‚‰ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

---

# å®Ÿé¨“ 2: DNS ã«ã‚ˆã‚‹åå‰è§£æ±º

å®Ÿé¨“ 1 ã§ã¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´æ¥æŒ‡å®šã—ã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã—ãŸãŒã€å®Ÿéš›ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯**ãƒ‰ãƒ¡ã‚¤ãƒ³å**ã‚’ä½¿ã†ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚ã“ã®å®Ÿé¨“ã§ã¯ã€DNS ãŒ Dual Stack ç’°å¢ƒã§ã©ã®ã‚ˆã†ã«å‹•ä½œã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚

## A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰

DNS ã«ã¯ IPv4 ç”¨ã¨ IPv6 ç”¨ã® 2 ç¨®é¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚

| ãƒ¬ã‚³ãƒ¼ãƒ‰ | æ­£å¼åç§°       | ç”¨é€”                | ä¾‹                                                 |
| -------- | -------------- | ------------------- | -------------------------------------------------- |
| **A**    | Address Record | IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™ | `example.com â†’ 93.184.216.34`                      |
| **AAAA** | Quad-A Record  | IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™ | `example.com â†’ 2606:2800:220:1:248:1893:25c8:1946` |

> **ãªãœ AAAA ã¨ã„ã†åå‰ãªã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ**
> - A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ 32 ãƒ“ãƒƒãƒˆï¼ˆ4 ãƒã‚¤ãƒˆï¼‰ã® IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™
> - AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ 128 ãƒ“ãƒƒãƒˆï¼ˆ16 ãƒã‚¤ãƒˆï¼‰ã® IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™
> - 128 Ã· 32 = 4 ãªã®ã§ã€ã€ŒA ã‚’ 4 ã¤ã€â†’ AAAAï¼ˆã‚¯ã‚¢ãƒƒãƒ‰ã‚¨ãƒ¼ï¼‰
> - ã€Œã‚¯ãƒ¯ãƒƒãƒ‰ã‚¨ãƒ¼ã€ã€Œãƒ•ã‚©ãƒ¼ã‚¨ãƒ¼ã€ã¨ã‚‚å‘¼ã°ã‚Œã¾ã™

### Dual Stack ãƒ‰ãƒ¡ã‚¤ãƒ³ã® DNS è¨­å®šä¾‹

```
ã€A ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ï¼ˆIPv4 å°‚ç”¨ï¼‰ã€‘
example.com.  IN  A     93.184.216.34

ã€AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ï¼ˆIPv6 å°‚ç”¨ï¼‰ã€‘
example.com.  IN  AAAA  2606:2800:220:1:248:1893:25c8:1946

ã€A + AAAA ä¸¡æ–¹ï¼ˆDual Stackï¼‰ã€‘
example.com.  IN  A     93.184.216.34
example.com.  IN  AAAA  2606:2800:220:1:248:1893:25c8:1946
```

## DNS åå‰è§£æ±ºãƒ•ãƒ­ãƒ¼

ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ‰ãƒ¡ã‚¤ãƒ³åã§ Web ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã®æµã‚Œã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant Client as client
    participant DNS as dns<br/>(CoreDNS)
    participant Web as web<br/>(nginx)

    Note over Client,Web: ãƒ‰ãƒ¡ã‚¤ãƒ³åã§ã‚¢ã‚¯ã‚»ã‚¹
    Client->>DNS: dual-ok.local ã® A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ
    activate DNS
    DNS-->>Client: 172.30.0.10
    deactivate DNS

    Client->>DNS: dual-ok.local ã® AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯ï¼Ÿ
    activate DNS
    DNS-->>Client: fd00:dead:beef::10
    deactivate DNS

    Note over Client: IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶š
    Client->>Web: HTTP GET (IPv6)
    activate Web
    Web-->>Client: HTTP 200 OK
    deactivate Web
```

## dig ã‚³ãƒãƒ³ãƒ‰ã§ DNS ã‚’ç¢ºèª

`dig` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã€DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç›´æ¥ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ã®ç¢ºèª

```bash
dig dual-ok.local A +short
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
172.30.0.10
```

### AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰ã®ç¢ºèª

```bash
dig dual-ok.local AAAA +short
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
fd00:dead:beef::10
```

### è©³ç´°ãª DNS å¿œç­”ã‚’ç¢ºèª

`+short` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’å¤–ã™ã¨ã€DNS å¿œç­”ã®è©³ç´°ãŒç¢ºèªã§ãã¾ã™ã€‚

```bash
dig dual-ok.local A
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
; <<>> DiG 9.18.24 <<>> dual-ok.local A
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 12345
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; QUESTION SECTION:
;dual-ok.local.                 IN      A

;; ANSWER SECTION:
dual-ok.local.          3600    IN      A       172.30.0.10

;; Query time: 1 msec
;; SERVER: 172.30.0.53#53(172.30.0.53)
;; WHEN: ...
;; MSG SIZE  rcvd: 60
```

**å‡ºåŠ›ã®èª­ã¿æ–¹**:
- `status: NOERROR`: DNS ã‚¯ã‚¨ãƒªãŒæˆåŠŸ
- `ANSWER: 1`: 1 ã¤ã®å›ç­”ãŒè¿”ã£ã¦ããŸ
- `A 172.30.0.10`: A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦ 172.30.0.10 ãŒè¿”ã•ã‚ŒãŸ
- `SERVER: 172.30.0.53`: CoreDNSï¼ˆ172.30.0.53ï¼‰ãŒå¿œç­”

### DNS ã‚µãƒ¼ãƒã®ç¢ºèª

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒã©ã® DNS ã‚µãƒ¼ãƒã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚

```bash
cat /etc/resolv.conf
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
nameserver 172.30.0.53
```

compose.yaml ã§ `dns: - 172.30.0.53` ã¨è¨­å®šã—ãŸãŸã‚ã€CoreDNS ãŒ DNS ã‚µãƒ¼ãƒã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

## åå‰ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹

IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ãªãã€ãƒ‰ãƒ¡ã‚¤ãƒ³åã§ Web ã‚µãƒ¼ãƒã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

```bash
curl -v http://dual-ok.local/
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆæŠœç²‹ï¼‰**:

```
*   Trying [fd00:dead:beef::10]:80...
* Connected to dual-ok.local (fd00:dead:beef::10) port 80
> GET / HTTP/1.1
> Host: dual-ok.local
> User-Agent: curl/8.5.0
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.25.4
< Content-Type: text/html
...
```

### æ³¨ç›®ã™ã¹ããƒã‚¤ãƒ³ãƒˆ

```
*   Trying [fd00:dead:beef::10]:80...
```

**IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ¥ç¶šã—ã¦ã„ã¾ã™ï¼** curl ã¯ DNS ã‹ã‚‰ A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‚’å–å¾—ã—ã€**IPv6 ã‚’å„ªå…ˆ**ã—ã¦æ¥ç¶šã‚’è©¦ã¿ã¦ã„ã¾ã™ã€‚

### ãªãœ IPv6 ãŒå„ªå…ˆã•ã‚Œã‚‹ã®ã‹ï¼Ÿ

RFC 6724ï¼ˆDefault Address Selection for Internet Protocol Version 6ï¼‰ã§ã€IPv6 ã‚’å„ªå…ˆã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

```
ã€å„ªå…ˆé †ä½ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‘
1. IPv6ï¼ˆAAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰â†’ å„ªå…ˆ
2. IPv4ï¼ˆA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼‰â†’ æ¬¡ç‚¹

ã€ç†ç”±ã€‘
- IPv6 ã¯å°†æ¥æ€§ãŒã‚ã‚‹
- NAT ã‚’çµŒç”±ã—ãªã„ç›´æ¥é€šä¿¡ãŒå¯èƒ½
- ã‚ˆã‚Šæ–°ã—ã„ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ä½¿ã†ã¹ã
```

> **æ³¨æ„**: å®Ÿéš›ã®å„ªå…ˆé †ä½ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®šã‚„ OS ã«ã‚ˆã£ã¦ç•°ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

## IPv4 ã‚’å¼·åˆ¶ã—ã¦æ¥ç¶š

`-4` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã¨ã€å¼·åˆ¶çš„ã« IPv4 ã§æ¥ç¶šã§ãã¾ã™ã€‚

```bash
curl -4 -v http://dual-ok.local/
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆæŠœç²‹ï¼‰**:

```
*   Trying 172.30.0.10:80...
* Connected to dual-ok.local (172.30.0.10) port 80
```

ä»Šåº¦ã¯ IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ172.30.0.10ï¼‰ã«æ¥ç¶šã—ã¦ã„ã¾ã™ã€‚

## ã“ã“ã¾ã§ã®å­¦ã³

ã“ã®å®Ÿé¨“ã§ç¢ºèªã§ããŸã“ã¨ï¼š

| ç¢ºèªé …ç›®              | çµæœ                                            |
| --------------------- | ----------------------------------------------- |
| A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰    | `dig dual-ok.local A` â†’ `172.30.0.10`           |
| AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰ | `dig dual-ok.local AAAA` â†’ `fd00:dead:beef::10` |
| ãƒ‰ãƒ¡ã‚¤ãƒ³åã§ã‚¢ã‚¯ã‚»ã‚¹  | curl ã¯ **IPv6 ã‚’å„ªå…ˆ**ã—ã¦æ¥ç¶š                 |
| IPv4 å¼·åˆ¶             | `curl -4` ã§ IPv4 æ¥ç¶šã‚’å¼·åˆ¶å¯èƒ½                |

**ãƒã‚¤ãƒ³ãƒˆ**:
- DNS ã¯ **A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰ã®ä¸¡æ–¹** ã‚’è¿”ã™ã“ã¨ãŒã§ãã‚‹
- Dual Stack å¯¾å¿œã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆcurl ãªã©ï¼‰ã¯é€šå¸¸ **IPv6 ã‚’å„ªå…ˆ**ã—ã¦æ¥ç¶šã‚’è©¦ã¿ã‚‹
- ã“ã‚Œã¯ RFC 6724 ã§æ¨å¥¨ã•ã‚Œã¦ã„ã‚‹å‹•ä½œ

---

# å®Ÿé¨“ 3: IPv6 éšœå®³æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

ã“ã®å®Ÿé¨“ã¯ã€Dual Stack ã®**çœŸä¾¡**ãŒç™ºæ®ã•ã‚Œã‚‹å ´é¢ã§ã™ã€‚**IPv6 ãŒå£Šã‚ŒãŸã¨ãã€è‡ªå‹•çš„ã« IPv4 ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã‹ã©ã†ã‹**ã‚’è¦³å¯Ÿã—ã¾ã™ã€‚ã“ã‚ŒãŒã€Œãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã¨å‘¼ã°ã‚Œã‚‹é‡è¦ãªå‹•ä½œã§ã™ã€‚

## ãªãœãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒé‡è¦ãªã®ã‹ï¼Ÿ

ç¾å®Ÿä¸–ç•Œã§ã¯ã€IPv6 ãŒã€Œå£Šã‚Œã‚‹ã€ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

| éšœå®³ãƒ‘ã‚¿ãƒ¼ãƒ³             | åŸå›                         | ç™ºç”Ÿé »åº¦       |
| ------------------------ | --------------------------- | -------------- |
| **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°éšœå®³**     | ISP ã® IPv6 çµŒè·¯ãŒä¸å®‰å®š    | æ¯”è¼ƒçš„å¤šã„     |
| **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š** | IPv6 ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹   | ã‚ˆãã‚ã‚‹       |
| **å¤ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨** | IPv6 éå¯¾å¿œã¾ãŸã¯ä¸å®Œå…¨     | ä¼æ¥­å†…ã§ã¯å¤šã„ |
| **è¨­å®šãƒŸã‚¹**             | AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ | ãŸã¾ã«ã‚ã‚‹     |
| **ä¸­é–“è£…ç½®ã®å•é¡Œ**       | NAT64/DNS64 ã®ä¸å…·åˆ        | ç‰¹å®šç’°å¢ƒã§ç™ºç”Ÿ |

ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ãŒãªã‘ã‚Œã°ã€IPv6 ãŒå£Šã‚ŒãŸæ™‚ç‚¹ã§**é€šä¿¡ä¸èƒ½**ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚Dual Stack ã¯ã€ã“ã®å•é¡Œã‚’è§£æ±ºã—ã¾ã™ã€‚

## éšœå®³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç’°å¢ƒ

CoreDNS ã§ `dual-badv6.local` ã¨ã„ã†**æ„å›³çš„ã«å£Šã‚ŒãŸ**ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã—ã¦ã„ã¾ã™ã€‚

| ãƒ‰ãƒ¡ã‚¤ãƒ³         | A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ | AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰  | çŠ¶æ…‹                |
| ---------------- | ------------------ | ---------------------- | ------------------- |
| dual-ok.local    | 172.30.0.10 âœ…      | fd00:dead:beef::10 âœ…   | æ­£å¸¸                |
| dual-badv6.local | 172.30.0.10 âœ…      | fd00:dead:beef::9999 âŒ | **IPv6 ãŒåˆ°é”ä¸èƒ½** |

### ãªãœ ::9999 ã¯åˆ°é”ä¸èƒ½ãªã®ã‹ï¼Ÿ

```
ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å†…ã®å®Ÿéš›ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã€‘
fd00:dead:beef::10  â†’ nginx ã‚³ãƒ³ãƒ†ãƒŠï¼ˆå­˜åœ¨ã™ã‚‹ï¼‰
fd00:dead:beef::20  â†’ client ã‚³ãƒ³ãƒ†ãƒŠï¼ˆå­˜åœ¨ã™ã‚‹ï¼‰
fd00:dead:beef::53  â†’ dns ã‚³ãƒ³ãƒ†ãƒŠï¼ˆå­˜åœ¨ã™ã‚‹ï¼‰

ã€::9999 ã¯ï¼Ÿã€‘
fd00:dead:beef::9999 â†’ ã©ã®ã‚³ãƒ³ãƒ†ãƒŠã«ã‚‚å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ãªã„ï¼ˆå­˜åœ¨ã—ãªã„ï¼‰

ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ‘ã‚±ãƒƒãƒˆã‚’é€ã£ã¦ã‚‚ã€èª°ã‚‚å¿œç­”ã—ãªã„
â†’ æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ãªã‚‹
```

## DNS ã§å£Šã‚ŒãŸ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèª

ã¾ãšã€dual-badv6.local ã® DNS ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
# A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰
dig dual-badv6.local A +short
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
172.30.0.10
```

æ­£å¸¸ãªã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚

```bash
# AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰
dig dual-badv6.local AAAA +short
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
fd00:dead:beef::9999
```

**åˆ°é”ä¸èƒ½ãªã‚¢ãƒ‰ãƒ¬ã‚¹**ãŒè¿”ã£ã¦ãã¾ã™ã€‚DNS ã¨ã—ã¦ã¯æ­£ã—ãå‹•ä½œã—ã¦ã„ã¾ã™ãŒã€ã“ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ã¯èª°ã‚‚ã„ã¾ã›ã‚“ã€‚

## curl ã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¦³å¯Ÿ

å®Ÿéš›ã«æ¥ç¶šã‚’è©¦ã¿ã¦ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œã‚’è¦³å¯Ÿã—ã¾ã™ã€‚

```bash
curl -v --connect-timeout 3 http://dual-badv6.local/
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®èª¬æ˜**:
- `-v`: è©³ç´°ãªå‡ºåŠ›ï¼ˆverboseï¼‰
- `--connect-timeout 3`: æ¥ç¶šã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’ 3 ç§’ã«è¨­å®š

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆæŠœç²‹ï¼‰**:

```
* Host dual-badv6.local:80 was resolved.
* IPv6: fd00:dead:beef::9999
* IPv4: 172.30.0.10
*   Trying [fd00:dead:beef::9999]:80...
*   Trying 172.30.0.10:80...
* Connected to dual-badv6.local (172.30.0.10) port 80
> GET / HTTP/1.1
> Host: dual-badv6.local
> User-Agent: curl/8.5.0
> Accept: */*
>
< HTTP/1.1 200 OK
< Server: nginx/1.25.4
...
```

### å‡ºåŠ›ã®èª­ã¿æ–¹

```
1. * IPv6: fd00:dead:beef::9999    â† DNS ã‹ã‚‰ AAAA ã‚’å–å¾—
   * IPv4: 172.30.0.10             â† DNS ã‹ã‚‰ A ã‚’å–å¾—

2. *   Trying [fd00:dead:beef::9999]:80...  â† IPv6 ã§æ¥ç¶šè©¦è¡Œ
   ï¼ˆã“ã“ã§å¾…ã¡æ™‚é–“ãŒç™ºç”Ÿï¼‰

3. *   Trying 172.30.0.10:80...    â† IPv4 ã§ã‚‚ä¸¦åˆ—ã«æ¥ç¶šè©¦è¡Œ

4. * Connected to dual-badv6.local (172.30.0.10) port 80
   â†‘ IPv4 ã§æ¥ç¶šæˆåŠŸï¼

5. < HTTP/1.1 200 OK               â† æ­£å¸¸ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡
```

**è¦³å¯Ÿãƒã‚¤ãƒ³ãƒˆ**:

1. DNS ã‹ã‚‰ **A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸¡æ–¹**ã‚’å–å¾—
2. ã¾ãš **IPv6ï¼ˆ::9999ï¼‰ã¸ã®æ¥ç¶šã‚’è©¦è¡Œ**
3. IPv6 ãŒå¿œç­”ã—ãªã„ãŸã‚ã€**IPv4ï¼ˆ172.30.0.10ï¼‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**
4. IPv4 ã§**æ¥ç¶šæˆåŠŸ**
5. **æ­£å¸¸ã« HTTP é€šä¿¡ãŒå®Œäº†**

ã“ã‚ŒãŒ **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯** ã®å‹•ä½œã§ã™ã€‚IPv6 ãŒå£Šã‚Œã¦ã„ã¦ã‚‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯æ­£å¸¸ã« Web ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

## IPv6 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ•ãƒ­ãƒ¼

ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¯ã€IPv6 ãŒåˆ°é”ä¸èƒ½ãªå ´åˆã« IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹æµã‚Œã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant Client as client
    participant DNS as dns<br/>(CoreDNS)
    participant Web as web<br/>(nginx)
    participant Dead as ::9999<br/>(å­˜åœ¨ã—ãªã„)

    Note over Client,Dead: dual-badv6.local ã«ã‚¢ã‚¯ã‚»ã‚¹
    Client->>DNS: dual-badv6.local ã® A/AAAA ã¯ï¼Ÿ
    activate DNS
    DNS-->>Client: A: 172.30.0.10<br/>AAAA: fd00:dead:beef::9999
    deactivate DNS

    Note over Client: IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶šè©¦è¡Œ
    Client-xDead: HTTP GET (IPv6)
    Note over Client,Dead: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆåˆ°é”ä¸èƒ½ï¼‰

    Note over Client: IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    Client->>Web: HTTP GET (IPv4)
    activate Web
    Web-->>Client: HTTP 200 OK
    deactivate Web

    Note over Client,Web: IPv6 ãŒå£Šã‚Œã¦ã„ã¦ã‚‚<br/>IPv4 ã§æ­£å¸¸ã«é€šä¿¡æˆåŠŸ
```

## Python ã§è©³ç´°ã«è¦³å¯Ÿ

curl ã¯é«˜é€Ÿã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ãŒã€**ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹**ã‚’ã‚ˆã‚Šè©³ç´°ã«è¦³å¯Ÿã™ã‚‹ãŸã‚ã«ã€Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½¿ç”¨ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æº–å‚™

ã¾ãšã€åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ï¼ˆã‚³ãƒ³ãƒ†ãƒŠã®å¤–ã§ï¼‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚

```bash
# ãƒ›ã‚¹ãƒˆå´ã§å®Ÿè¡Œï¼ˆã‚³ãƒ³ãƒ†ãƒŠã®å¤–ï¼‰
docker cp scripts/ds_client.py rd-ds-client:/tmp/
```

### æ­£å¸¸ç³»ãƒ†ã‚¹ãƒˆ

ã¾ãšã€æ­£å¸¸ãªãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆdual-ok.localï¼‰ã§ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
python3 /tmp/ds_client.py dual-ok.local 80
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
resolved: dual-ok.local:80
  - IPv6 ('fd00:dead:beef::10', 80, 0, 0)
  - IPv4 ('172.30.0.10', 80)
try IPv6: ('fd00:dead:beef::10', 80, 0, 0) ...
connected via IPv6 in 0.5 ms
recv: HTTP/1.1 200 OK
```

**å‡ºåŠ›ã®èª­ã¿æ–¹**:
- `resolved`: DNS åå‰è§£æ±ºã®çµæœï¼ˆIPv6 ãŒå…ˆã«ãƒªã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ = å„ªå…ˆï¼‰
- `try IPv6`: IPv6 ã§ã®æ¥ç¶šã‚’è©¦è¡Œ
- `connected via IPv6 in 0.5 ms`: IPv6 ã§æ¥ç¶šæˆåŠŸï¼ˆ0.5 ãƒŸãƒªç§’ï¼‰
- `recv: HTTP/1.1 200 OK`: HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ

æ¬¡ã«ã€å£Šã‚ŒãŸãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆdual-badv6.localï¼‰ã§ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ
python3 /tmp/ds_client.py dual-badv6.local 80
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
resolved: dual-badv6.local:80
  - IPv6 ('fd00:dead:beef::9999', 80, 0, 0)
  - IPv4 ('172.30.0.10', 80)
try IPv6: ('fd00:dead:beef::9999', 80, 0, 0) ...
failed via IPv6: timed out
try IPv4: ('172.30.0.10', 80) ...
connected via IPv4 in 0.8 ms
recv: HTTP/1.1 200 OK
```

**å‡ºåŠ›ã®èª­ã¿æ–¹**:
- `try IPv6: ... failed via IPv6: timed out`: IPv6 æ¥ç¶šãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ2 ç§’å¾…ã¡ï¼‰
- `try IPv4: ... connected via IPv4 in 0.8 ms`: IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦æ¥ç¶šæˆåŠŸ
- `recv: HTTP/1.1 200 OK`: æœ€çµ‚çš„ã« HTTP é€šä¿¡ã«æˆåŠŸ

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•ä½œåŸç†

ã“ã® Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€curl ã‚ˆã‚Šã‚‚**ã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„**ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ã‚’ã—ã¦ã„ã¾ã™ã€‚

```python
# 1. DNS åå‰è§£æ±º
infos = socket.getaddrinfo(host, port, 0, socket.SOCK_STREAM)

# 2. IPv6 ã‚’å„ªå…ˆã™ã‚‹ã‚ˆã†ã«ã‚½ãƒ¼ãƒˆ
infos = sorted(infos, key=lambda x: 0 if x[0] == socket.AF_INET6 else 1)

# 3. é †ç•ªã«æ¥ç¶šã‚’è©¦è¡Œï¼ˆIPv6 â†’ IPv4ï¼‰
for fam, _, _, _, sockaddr in infos:
    s, dt, err = try_connect(fam, sockaddr)
    if s:
        # æ¥ç¶šæˆåŠŸ
        break
```

**ãƒã‚¤ãƒ³ãƒˆ**:
- `socket.getaddrinfo()` ã§ A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ä¸¡æ–¹ã‚’å–å¾—
- IPv6 ã‚’å„ªå…ˆï¼ˆå…ˆé ­ã«ï¼‰ã—ã¦ã‚½ãƒ¼ãƒˆ
- é †ç•ªã«æ¥ç¶šã‚’è©¦è¡Œã—ã€å¤±æ•—ã—ãŸã‚‰æ¬¡ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã¸

> **curl ã¨ã®é•ã„**
> - ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ: **é †æ¬¡**æ¥ç¶šï¼ˆIPv6 â†’ å¤±æ•— â†’ IPv4ï¼‰
> - curl (Happy Eyeballs): **ä¸¦åˆ—**æ¥ç¶šï¼ˆIPv6 ã¨ IPv4 ã‚’åŒæ™‚ã«è©¦è¡Œï¼‰
> - ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ–¹ãŒå‹•ä½œãŒã‚ã‹ã‚Šã‚„ã™ã„ãŒã€å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ Happy Eyeballs ã®æ–¹ãŒé«˜é€Ÿ

## Happy Eyeballs ã¨ã¯

ãƒ¢ãƒ€ãƒ³ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã€curl ãªã©ï¼‰ã¯ã€Œ**Happy Eyeballs**ã€ï¼ˆRFC 8305ï¼‰ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### ãªãœã€ŒHappy Eyeballsã€ã¨ã„ã†åå‰ãªã®ã‹ï¼Ÿ

```
ã€ç”±æ¥ã€‘
ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®ã‚’å¹¸ã›ã«ã™ã‚‹ã€= å¾…ã¡æ™‚é–“ã‚’æœ€å°åŒ–ã™ã‚‹

IPv6 ãŒæ™®åŠã—å§‹ã‚ãŸé ƒã€ã“ã‚“ãªå•é¡ŒãŒã‚ã‚Šã¾ã—ãŸï¼š
1. IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶šè©¦è¡Œ
2. IPv6 ãŒå£Šã‚Œã¦ã„ã‚‹ â†’ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¾ã§å¾…ã¤ï¼ˆæ•°ç§’ã€œæ•°åç§’ï¼‰
3. ã‚ˆã†ã‚„ã IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼šã€Œé…ã„ï¼ğŸ˜¢ã€

Happy Eyeballs ã¯ã“ã‚Œã‚’è§£æ±ºï¼š
1. IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶šè©¦è¡Œ
2. 250ms å¾…ã£ã¦ã‚‚å¿œç­”ãŒãªã‘ã‚Œã° IPv4 ã‚‚ä¸¦åˆ—ã§è©¦è¡Œ
3. å…ˆã«æˆåŠŸã—ãŸæ–¹ã‚’ä½¿ç”¨
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼šã€Œé€Ÿã„ï¼ğŸ˜Šã€
```

### Happy Eyeballs ã®å‹•ä½œ

ä»¥ä¸‹ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ã¯ã€Happy Eyeballs ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ä¸¦åˆ—æ¥ç¶šã®æµã‚Œã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

```mermaid
sequenceDiagram
    autonumber
    participant Client as client
    participant IPv6 as IPv6 ã‚µãƒ¼ãƒ
    participant IPv4 as IPv4 ã‚µãƒ¼ãƒ

    Note over Client,IPv4: Happy Eyeballs ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

    Client->>IPv6: æ¥ç¶šè©¦è¡Œï¼ˆIPv6ï¼‰
    activate IPv6
    Note over Client: 250ms å¾…æ©Ÿ...

    Client->>IPv4: æ¥ç¶šè©¦è¡Œï¼ˆIPv4ï¼‰ã‚’ä¸¦åˆ—é–‹å§‹
    activate IPv4

    IPv4-->>Client: æ¥ç¶šæˆåŠŸ
    deactivate IPv4
    Note over Client: IPv4 ãŒå…ˆã«æˆåŠŸ

    IPv6--xClient: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    deactivate IPv6

    Note over Client,IPv4: å…ˆã«æˆåŠŸã—ãŸ IPv4 ã‚’ä½¿ç”¨
    Client->>IPv4: HTTP GET
    activate IPv4
    IPv4-->>Client: HTTP 200 OK
    deactivate IPv4
```

### Happy Eyeballs ã®ç‰¹å¾´

| é …ç›®           | èª¬æ˜                                                        |
| -------------- | ----------------------------------------------------------- |
| **é…å»¶æ™‚é–“**   | IPv6 ã‚’å„ªå…ˆã™ã‚‹ãŒã€250ms å¾…ã£ã¦ã‚‚å¿œç­”ãŒãªã‘ã‚Œã° IPv4 ã‚‚è©¦è¡Œ |
| **ä¸¦åˆ—æ¥ç¶š**   | IPv6 ã¨ IPv4 ã®æ¥ç¶šè©¦è¡Œã‚’**ä¸¦åˆ—**ã§è¡Œã†                     |
| **æœ€åˆã®å‹è€…** | å…ˆã«æ¥ç¶šæˆåŠŸã—ãŸæ–¹ã‚’ä½¿ç”¨ï¼ˆãƒ¬ãƒ¼ã‚¹ï¼‰                          |
| **ã‚­ãƒ£ãƒƒã‚·ãƒ¥** | æˆåŠŸã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚¡ãƒŸãƒªã‚’è¨˜æ†¶ã—ã€æ¬¡å›ã¯å„ªå…ˆ                |

### RFC 8305 ã®ãƒã‚¤ãƒ³ãƒˆ

RFC 8305ï¼ˆHappy Eyeballs Version 2ï¼‰ã§ã¯ã€å…·ä½“çš„ãªé…å»¶æ™‚é–“ãŒè¦å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

**RFC 8305 ã‹ã‚‰ã®å¼•ç”¨ï¼ˆåŸæ–‡ï¼‰**:

> **Resolution Delay**:
> "The recommended value for the Resolution Delay is **50 milliseconds**."
>
> **Connection Attempt Delay**:
> "The recommended value for the Connection Attempt Delay is **250 milliseconds**."
> "A Connection Attempt Delay MUST NOT be less than **100 ms** [...] and SHOULD NOT be greater than **2 seconds**."
>
> â€” [RFC 8305 Section 5 & 8](https://datatracker.ietf.org/doc/html/rfc8305)

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿                  | æ¨å¥¨å€¤    | æœ€å°å€¤   | æœ€å¤§å€¤   | èª¬æ˜                                 |
| --------------------------- | --------- | -------- | -------- | ------------------------------------ |
| **Resolution Delay**        | 50ms      | -        | -        | A/AAAA ä¸¡æ–¹ã®åå‰è§£æ±ºã‚’å¾…ã¤æ™‚é–“      |
| **Connection Attempt Delay** | 250ms     | 100ms    | 2ç§’      | IPv6 ã®å¿œç­”ã‚’å¾…ã£ã¦ã‹ã‚‰ IPv4 ã‚’è©¦è¡Œ  |

```
ã€RFC 8305 - Happy Eyeballs Version 2 ã®å‹•ä½œãƒ•ãƒ­ãƒ¼ã€‘

1. DNS ã§ A ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’åŒæ™‚ã«ã‚¯ã‚¨ãƒª
2. Resolution Delay (50ms) ä»¥å†…ã«ä¸¡æ–¹æƒã‚ãªãã¦ã‚‚ã€å±Šã„ãŸæ–¹ã§é–‹å§‹
3. IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶šè©¦è¡Œ
4. Connection Attempt Delay (250ms) å¾…ã£ã¦ã‚‚å¿œç­”ãŒãªã‘ã‚Œã° IPv4 ã‚‚è©¦è¡Œ
5. å…ˆã«æˆåŠŸã—ãŸæ–¹ã‚’ä½¿ç”¨
6. æˆåŠŸã—ãŸã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ•ã‚¡ãƒŸãƒªã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦æ¬¡å›å„ªå…ˆ
```

### ã©ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ Happy Eyeballs ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‹ï¼Ÿ

| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ          | Happy Eyeballs | å‚™è€ƒ              |
| --------------------- | -------------- | ----------------- |
| **Chrome / Chromium** | âœ… RFC 8305     | å®Œå…¨å®Ÿè£…          |
| **Firefox**           | âœ… RFC 8305     | å®Œå…¨å®Ÿè£…          |
| **Safari**            | âœ… RFC 8305     | å®Œå…¨å®Ÿè£…          |
| **curl**              | âœ… RFC 8305     | 7.59.0 ä»¥é™       |
| **Python requests**   | âš ï¸ éƒ¨åˆ†çš„       | urllib3 ä¾å­˜      |
| **Node.js**           | âš ï¸ OS ä¾å­˜      | dns.lookup() ä¾å­˜ |

## ã“ã“ã¾ã§ã®å­¦ã³

ã“ã®å®Ÿé¨“ã§ç¢ºèªã§ããŸã“ã¨ï¼š

| ç¢ºèªé …ç›®           | çµæœ                                                   |
| ------------------ | ------------------------------------------------------ |
| IPv6 éšœå®³æ™‚        | è‡ªå‹•çš„ã« IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯                         |
| ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚é–“ | curl: 250ms ä»¥å†…ã€Python: 2 ç§’ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šä¾å­˜ï¼‰ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“       | IPv6 ãŒå£Šã‚Œã¦ã„ã¦ã‚‚ Web ãƒšãƒ¼ã‚¸ã¯è¡¨ç¤ºã•ã‚Œã‚‹             |

**ãƒã‚¤ãƒ³ãƒˆ**:
- IPv6 ãŒå£Šã‚Œã¦ã‚‚ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯**è‡ªå‹•çš„ã« IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**ã™ã‚‹
- ã“ã‚Œã¯ã€Œ**Happy Eyeballs**ã€ï¼ˆRFC 8305ï¼‰ã¨ã„ã†ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã«ã‚ˆã‚‹ã‚‚ã®
- Dual Stack ã¯**å¯ç”¨æ€§**ã‚’é«˜ã‚ã‚‹è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚‚ã‚ã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ IPv6 ã®éšœå®³ã«**æ°—ã¥ã‹ãªã„**ï¼ˆã“ã‚ŒãŒç†æƒ³çš„ãªå‹•ä½œï¼‰

---

# ã“ã®å®Ÿé¨“ã‹ã‚‰å­¦ã‚“ã ã“ã¨

3 ã¤ã®å®Ÿé¨“ã‚’é€šã˜ã¦ã€IPv6 Dual Stack ã®åŸºæœ¬çš„ãªå‹•ä½œã‚’ä½“é¨“ã—ã¾ã—ãŸã€‚ã“ã“ã§ã€å­¦ã‚“ã ã“ã¨ã‚’æ•´ç†ã—ã¾ã—ã‚‡ã†ã€‚

## å®Ÿé¨“ã®ã¾ã¨ã‚

| å®Ÿé¨“       | ç¢ºèªã—ãŸã“ã¨                    | æŠ€è¡“çš„ãªãƒã‚¤ãƒ³ãƒˆ            |
| ---------- | ------------------------------- | --------------------------- |
| **å®Ÿé¨“ 1** | IPv4/IPv6 ä¸¡æ–¹ã§é€šä¿¡å¯èƒ½        | Dual Stack ã®åŸºæœ¬å‹•ä½œ       |
| **å®Ÿé¨“ 2** | DNS ã§ A/AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™    | IPv6 å„ªå…ˆã®åå‰è§£æ±º         |
| **å®Ÿé¨“ 3** | IPv6 éšœå®³æ™‚ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | Happy Eyeballs ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |

## Dual Stack ã®æœ¬è³ª

Dual Stack ã¯å˜ã«ã€ŒIPv4 ã¨ IPv6 ã®ä¸¡æ–¹ãŒä½¿ãˆã‚‹ã€ã¨ã„ã†ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**3 ã¤ã®é‡è¦ãªä¾¡å€¤**ã‚’æä¾›ã—ã¾ã™ã€‚

### 1. ç§»è¡Œæˆ¦ç•¥

```
ã€å¾“æ¥ã®ç§»è¡Œã‚¢ãƒ—ãƒ­ãƒ¼ãƒã€‘
IPv4 ã®ã¿ â†’ ä¸€æ–‰ã« IPv6 ã¸åˆ‡æ›¿ â†’ ãƒªã‚¹ã‚¯ãŒé«˜ã„

ã€Dual Stack ã«ã‚ˆã‚‹æ®µéšçš„ç§»è¡Œã€‘
IPv4 ã®ã¿ â†’ Dual Stackï¼ˆä¸¡æ–¹å¯¾å¿œï¼‰â†’ IPv6 ã®ã¿

Phase 1: IPv4 ç’°å¢ƒã« IPv6 ã‚’è¿½åŠ ï¼ˆDual Stack åŒ–ï¼‰
Phase 2: æ–°è¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ IPv6 å„ªå…ˆ
Phase 3: IPv4 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒæ¸›å°‘
Phase 4: IPv4 ã‚’å»ƒæ­¢ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
```

### 2. å¯ç”¨æ€§ï¼ˆRedundancyï¼‰

```
ã€å˜ä¸€ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‘
IPv4 éšœå®³ â†’ ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ ğŸ˜¢
IPv6 éšœå®³ â†’ ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ ğŸ˜¢

ã€Dual Stackã€‘
IPv4 éšœå®³ â†’ IPv6 ã§ç¶™ç¶š âœ…
IPv6 éšœå®³ â†’ IPv4 ã§ç¶™ç¶š âœ…

ç‰‡æ–¹ãŒå£Šã‚Œã¦ã‚‚ã€ã‚‚ã†ç‰‡æ–¹ã§ã‚µãƒ¼ãƒ“ã‚¹ç¶™ç¶šå¯èƒ½
```

### 3. æŸ”è»Ÿæ€§

```
ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆ¥ã®å¯¾å¿œã€‘
- IPv6 å¯¾å¿œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ IPv6 ã§é«˜é€Ÿé€šä¿¡
- IPv4 ã®ã¿ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ IPv4 ã§äº’æ›æ€§ç¢ºä¿
- ãƒ¢ãƒã‚¤ãƒ«ï¼ˆIPv6 å„ªå…ˆï¼‰â†’ NAT ãªã—ã§ç›´æ¥é€šä¿¡

ã‚µãƒ¼ãƒå´ã¯ Dual Stack ã«ã—ã¦ãŠã‘ã°ã€
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®çŠ¶æ³ã«è‡ªå‹•çš„ã«å¯¾å¿œ
```

## ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®é‡è¦æ€§

ä»Šå›ã®å®Ÿé¨“ã§ã€IPv6 ãŒå£Šã‚Œã¦ã‚‚ IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚ã“ã‚Œã¯å®Ÿé‹ç”¨ã«ãŠã„ã¦**éå¸¸ã«é‡è¦ãªæ©Ÿèƒ½**ã§ã™ã€‚

### ã‚ˆãã‚ã‚‹éšœå®³ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾å‡¦

| éšœå®³ãƒ‘ã‚¿ãƒ¼ãƒ³                 | åŸå›                         | Dual Stack ã§ã®å‹•ä½œ     |
| ---------------------------- | --------------------------- | ----------------------- |
| **ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°éšœå®³**         | ISP ã® IPv6 çµŒè·¯ãŒä¸å®‰å®š    | IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ… |
| **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®šãƒŸã‚¹** | IPv6 ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹   | IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ… |
| **å¤ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨**     | IPv6 éå¯¾å¿œã®ãƒ«ãƒ¼ã‚¿         | IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ… |
| **DNS è¨­å®šãƒŸã‚¹**             | AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹ | IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ… |
| **ä¸­é–“è£…ç½®ã®å•é¡Œ**           | NAT64/DNS64 ã®ä¸å…·åˆ        | IPv4 ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ… |

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒãªã‹ã£ãŸã‚‰ï¼Ÿ

```
ã€IPv6 only ã®å ´åˆã€‘
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Web ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
2. IPv6 ã§æ¥ç¶šè©¦è¡Œ
3. IPv6 ãŒå£Šã‚Œã¦ã„ã‚‹ â†’ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆ30 ç§’å¾…ã¡ï¼‰
4. ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼šã€Œã‚µã‚¤ãƒˆãŒè½ã¡ã¦ã‚‹ï¼ã€

ã€Dual Stack + Happy Eyeballs ã®å ´åˆã€‘
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ Web ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
2. IPv6 ã§æ¥ç¶šè©¦è¡Œ
3. IPv6 ãŒå£Šã‚Œã¦ã„ã‚‹ â†’ 250ms å¾…ã¡
4. IPv4 ã§ã‚‚ä¸¦åˆ—æ¥ç¶šè©¦è¡Œ â†’ æˆåŠŸ
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼šã€Œï¼ˆä½•ã‚‚æ°—ã¥ã‹ãªã„ï¼‰ã€
```

## ç¾å®Ÿä¸–ç•Œã§ã®å¿œç”¨

### Web ã‚µãƒ¼ãƒ“ã‚¹

```
ã€å¾“æ¥ï¼ˆIPv4 onlyï¼‰ã€‘
ãƒ¢ãƒã‚¤ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ CGNAT â†’ ã‚µãƒ¼ãƒ
  â””â”€ NAT ã‚’çµŒç”±ã™ã‚‹ãŸã‚ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚ã‚Š

ã€Dual Stackã€‘
ãƒ¢ãƒã‚¤ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ ç›´æ¥ â†’ ã‚µãƒ¼ãƒï¼ˆIPv6ï¼‰
  â””â”€ NAT ãªã—ã§ End-to-End é€šä¿¡
  â””â”€ ä½é…å»¶ã€é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
```

### ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

```
ã€M&A æ™‚ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹é‡è¤‡å•é¡Œã€‘

å¾“æ¥: A ç¤¾ï¼ˆ10.0.0.0/8ï¼‰+ B ç¤¾ï¼ˆ10.0.0.0/8ï¼‰= é‡è¤‡ ğŸ’¥
  â””â”€ ã©ã¡ã‚‰ã‹ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å…¨é¢å†è¨­è¨ˆï¼ˆé«˜ã‚³ã‚¹ãƒˆï¼‰

Dual Stack:
  A ç¤¾: fd00:a::/48
  B ç¤¾: fd00:b::/48
  â””â”€ IPv6 ã¯é‡è¤‡ã—ãªã„ï¼ˆè¨­è¨ˆæ¬¡ç¬¬ï¼‰
  â””â”€ æ®µéšçš„ã« IPv6 ã«ç§»è¡Œã—ã¦å•é¡Œè§£æ±º
```

### ãƒãƒ«ãƒã‚¯ãƒ©ã‚¦ãƒ‰

```
ã€ã‚¯ãƒ©ã‚¦ãƒ‰é–“æ¥ç¶šã€‘
AWS â†â†’ Azure â†â†’ GCP

- å„ã‚¯ãƒ©ã‚¦ãƒ‰ã§ IPv4 ã‚µãƒ–ãƒãƒƒãƒˆãŒé‡è¤‡ã™ã‚‹ãƒªã‚¹ã‚¯
- IPv6 ãªã‚‰å„ã‚¯ãƒ©ã‚¦ãƒ‰ã«å›ºæœ‰ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰²ã‚Šå½“ã¦å¯èƒ½
- Dual Stack ã§ã©ã¡ã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã«ã‚‚æŸ”è»Ÿã«æ¥ç¶š
```

## å­¦ã‚“ã æŠ€è¡“ç”¨èªã®æ•´ç†

| ç”¨èª               | æ„å‘³                                       | ã“ã®å®Ÿé¨“ã§ã®é–¢é€£            |
| ------------------ | ------------------------------------------ | --------------------------- |
| **Dual Stack**     | IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã‚’åŒæ™‚ã«ä½¿ç”¨ã™ã‚‹æ§‹æˆ    | compose.yaml ã® enable_ipv6 |
| **ULA**            | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆfd00::/8ï¼‰     | fd00:dead:beef::/64         |
| **A ãƒ¬ã‚³ãƒ¼ãƒ‰**     | DNS ã§ IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™ãƒ¬ã‚³ãƒ¼ãƒ‰         | dig dual-ok.local A         |
| **AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰**  | DNS ã§ IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’è¿”ã™ãƒ¬ã‚³ãƒ¼ãƒ‰         | dig dual-ok.local AAAA      |
| **Happy Eyeballs** | IPv6/IPv4 ä¸¦åˆ—æ¥ç¶šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆRFC 8305ï¼‰ | curl ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ   |
| **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯** | å„ªå…ˆæ‰‹æ®µãŒå¤±æ•—æ™‚ã«ä»£æ›¿æ‰‹æ®µã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ | IPv6 â†’ IPv4 åˆ‡æ›¿            |

---

# Azure ã§ã® IPv6

ã“ã“ã¾ã§ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã® Dual Stack ã‚’ä½“é¨“ã—ã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯ã€**ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆAzureï¼‰ã§ã® IPv6** ã«ã¤ã„ã¦ã€ç¾å®Ÿçš„ãªåˆ¶ç´„ã¨è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚

## ãªãœã‚¯ãƒ©ã‚¦ãƒ‰ã§ã® IPv6 ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹ï¼Ÿ

```
ã€ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿé¨“ã¨ã®é•ã„ã€‘
ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆDockerï¼‰:
  - è‡ªç”±ã« IPv6 ã‚’è¨­å®šå¯èƒ½
  - åˆ¶ç´„ãªã—

ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆAzure/AWS/GCPï¼‰:
  - ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ³ãƒ€ãƒ¼ã®åˆ¶ç´„ã‚ã‚Š
  - ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«å¯¾å¿œçŠ¶æ³ãŒç•°ãªã‚‹
  - ã€Œå¯¾å¿œã—ã¦ã„ã‚‹ã€ã¨ã€Œä½¿ãˆã‚‹ã€ã¯åˆ¥
```

## Azure ã® IPv6 å¯¾å¿œçŠ¶æ³

Azure ã¯ IPv6 ã«å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€**ã‚µãƒ¼ãƒ“ã‚¹ã”ã¨ã«å¯¾å¿œçŠ¶æ³ãŒå¤§ããç•°ãªã‚Šã¾ã™**ã€‚

### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åŸºç›¤

| ã‚µãƒ¼ãƒ“ã‚¹      | IPv6 å¯¾å¿œ | Dual Stack | å‚™è€ƒ                               |
| ------------- | --------- | ---------- | ---------------------------------- |
| **VNet**      | âœ…         | âœ…          | IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’è¿½åŠ å¯èƒ½        |
| **Subnet**    | âœ…         | âœ…          | IPv4/IPv6 ä¸¡æ–¹ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²ã‚’è¨­å®š |
| **NSG**       | âœ…         | -          | IPv6 ãƒ«ãƒ¼ãƒ«ã‚’è¨˜è¿°å¯èƒ½              |
| **UDR**       | âœ…         | -          | IPv6 ãƒ«ãƒ¼ãƒˆã‚’å®šç¾©å¯èƒ½              |
| **Public IP** | âœ…         | âœ…          | Standard SKU ã§ Dual Stack å¯¾å¿œ    |

### ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚·ãƒ³ã‚°

| ã‚µãƒ¼ãƒ“ã‚¹                | IPv6 å¯¾å¿œ | Dual Stack | å‚™è€ƒ                |
| ----------------------- | --------- | ---------- | ------------------- |
| **Azure Load Balancer** | âœ…         | âœ…          | Standard SKU ã§å¯¾å¿œ |
| **Application Gateway** | âœ…         | âœ…          | v2 SKU ã§å¯¾å¿œ       |
| **Azure Front Door**    | âœ…         | âœ…          | ã‚°ãƒ­ãƒ¼ãƒãƒ«è² è·åˆ†æ•£  |

### é‡è¦ãªåˆ¶ç´„

| ã‚µãƒ¼ãƒ“ã‚¹             | IPv6 å¯¾å¿œ | å½±éŸ¿                               |
| -------------------- | --------- | ---------------------------------- |
| **Azure Firewall**   | âŒ         | **L7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä¸å¯**          |
| **Private Endpoint** | âŒ         | **PaaS ã¸ã®é–‰åŸŸæ¥ç¶šã¯ IPv4 ã®ã¿**  |
| **VPN Gateway**      | âŒ         | **ã‚ªãƒ³ãƒ—ãƒ¬æ¥ç¶šã¯ IPv4 ã®ã¿**       |
| **ExpressRoute**     | âš ï¸         | ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ”ã‚¢ãƒªãƒ³ã‚°ã¯ IPv4 ã®ã¿ |

## æœ€å¤§ã®åˆ¶ç´„: Azure Firewall

Azure Firewall ãŒ **IPv6 ã«å¯¾å¿œã—ã¦ã„ãªã„** ã“ã¨ã¯ã€ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºè¨­è¨ˆã«ãŠã„ã¦éå¸¸ã«å¤§ããªåˆ¶ç´„ã§ã™ã€‚

**Microsoft Learn å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰ã®å¼•ç”¨ï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰**:

> "**Azure Firewall doesn't currently support IPv6.** It can operate in a dual stack virtual network using only IPv4, but the firewall subnet must be IPv4-only."
>
> â€” [Azure IPv6 Overview - Microsoft Learn](https://learn.microsoft.com/azure/virtual-network/ip-services/ipv6-overview)

### ä½•ãŒå•é¡Œãªã®ã‹ï¼Ÿ

```mermaid
flowchart LR
    subgraph "IPv4 ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯"
        A4[Client IPv4] --> FW[Azure Firewall]
        FW --> S4[Server]
    end

    subgraph "IPv6 ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯"
        A6[Client IPv6] -.->|é€šéä¸å¯| FW2[Azure Firewall]
        A6 --> S6[Server]
    end

    style FW2 stroke-dasharray: 5 5
```

```
ã€Azure Firewall ã§ã§ãã‚‹ã“ã¨ï¼ˆIPv4ï¼‰ã€‘
- L7ï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼‰ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- FQDN ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ«ï¼ˆä¾‹: *.microsoft.com ã‚’è¨±å¯ï¼‰
- è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ã«ã‚ˆã‚‹ä¿è­·
- é€ä¿¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã®ä¸€å…ƒç®¡ç†
- ãƒ­ã‚°ã®é›†ç´„

ã€IPv6 ã§ã¯...ã€‘
- Azure Firewall ã‚’é€šéã§ããªã„
- NSGï¼ˆL3/L4ï¼‰ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ã¿
- FQDN ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ«ãŒä½¿ãˆãªã„
- è„…å¨ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ã‚¹ãŒä½¿ãˆãªã„
```

### Azure ã§ IPv6 éå¯¾å¿œã®ä¸»ãªã‚µãƒ¼ãƒ“ã‚¹ï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰

Microsoft Learn ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒ IPv6 ã«å¯¾å¿œã—ã¦ã„ãªã„ã¨æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

| ã‚µãƒ¼ãƒ“ã‚¹                       | IPv6 å¯¾å¿œ | å‚™è€ƒ                                   |
| ------------------------------ | --------- | -------------------------------------- |
| **Azure Firewall**             | âŒ         | L7 ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãŒ IPv6 ã§ä½¿ãˆãªã„  |
| **Azure Container Instances**  | âŒ         | ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ IPv4 ã®ã¿       |
| **Azure Container Apps**       | âŒ         | ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã¯ IPv4 ã®ã¿       |
| **Azure Virtual WAN**          | âŒ         | ã‚°ãƒ­ãƒ¼ãƒãƒ« WAN æ¥ç¶šã¯ IPv4 ã®ã¿        |
| **Azure Route Server**         | âŒ         | BGP ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ IPv4 ã®ã¿           |
| **Azure Database for PostgreSQL** | âŒ      | ãƒãƒãƒ¼ã‚¸ãƒ‰ PostgreSQL ã¯ IPv4 ã®ã¿     |

> **å‡ºå…¸**: [Azure IPv6 Overview - Microsoft Learn](https://learn.microsoft.com/azure/virtual-network/ip-services/ipv6-overview)

### ä»–ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã¨ã®æ¯”è¼ƒï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰

**AWS Network Firewall**ï¼ˆ2023å¹´1æœˆã‚ˆã‚Š IPv6 å¯¾å¿œï¼‰:

> "AWS Network Firewall now supports IPv6, allowing customers to deploy the firewall in dual-stack VPCs."
>
> â€” [AWS Network Firewall now supports IPv6](https://aws.amazon.com/about-aws/whats-new/2023/01/aws-network-firewall-supports-ipv6/)

**GCP VPC Firewall Rules**:

> "IPv6 connections are supported in VPC networks that have IPv6 enabled."
>
> â€” [VPC firewall rules overview - Google Cloud](https://cloud.google.com/firewall/docs/firewalls)

| ã‚¯ãƒ©ã‚¦ãƒ‰  | L7 ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«   | IPv6 å¯¾å¿œ | å¯¾å¿œé–‹å§‹æ™‚æœŸ |
| --------- | --------------------- | --------- | ------------ |
| **AWS**   | Network Firewall      | âœ…         | 2023å¹´1æœˆ    |
| **GCP**   | Cloud Firewall        | âœ…         | ï¼ˆåˆæœŸã‹ã‚‰ï¼‰ |
| **Azure** | Azure Firewall        | âŒ         | æœªå¯¾å¿œ       |

Azure ã® IPv6 å¯¾å¿œã¯ AWSãƒ»GCP ã«æ¯”ã¹ã¦é…ã‚Œã¦ãŠã‚Šã€ç‰¹ã« L7 ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãŒä½¿ãˆãªã„ç‚¹ã¯è¨­è¨ˆä¸Šã®å¤§ããªåˆ¶ç´„ã¨ãªã£ã¦ã„ã¾ã™ã€‚

## ç¾æ™‚ç‚¹ã®æ¨å¥¨è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

Azure ã§ IPv6 ã‚’ä½¿ã„ãŸã„å ´åˆã€ä»¥ä¸‹ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰é¸æŠã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | æ§‹æˆ                       | ãƒ¡ãƒªãƒƒãƒˆ                          | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ            | æ¨å¥¨åº¦ |
| -------- | -------------------------- | --------------------------------- | --------------------- | ------ |
| **A**    | IPv4 ã®ã¿ + Azure Firewall | Azure Firewall ã®ãƒ•ãƒ«æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ | IPv6 éå¯¾å¿œ           | â­â­â­    |
| **B**    | Dual Stack + NSG ã®ã¿      | IPv6 å¯¾å¿œ                         | L7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä¸å¯ | â­â­     |
| **C**    | Dual Stack + NVA           | IPv6 + L7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°          | é«˜ã‚³ã‚¹ãƒˆã€é‹ç”¨è² è·    | â­      |

### ãƒ‘ã‚¿ãƒ¼ãƒ³ A: IPv4 ã®ã¿ï¼ˆæ¨å¥¨ï¼‰

```
ã€æ§‹æˆã€‘
Internet â†’ Azure Firewall â†’ VNet (IPv4 only) â†’ VM/AKS

ã€ãƒ¡ãƒªãƒƒãƒˆã€‘
- Azure Firewall ã®ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒä½¿ãˆã‚‹
- é‹ç”¨ãŒã‚·ãƒ³ãƒ—ãƒ«
- ã‚³ã‚¹ãƒˆåŠ¹ç‡ãŒè‰¯ã„

ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã€‘
- IPv6 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸ã®ç›´æ¥å¯¾å¿œä¸å¯
  ï¼ˆFront Door ã‚„ CDN ã§ã‚«ãƒãƒ¼å¯èƒ½ï¼‰
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ B: Dual Stack + NSG

```
ã€æ§‹æˆã€‘
Internet (IPv4/IPv6) â†’ Load Balancer (Dual Stack) â†’ VNet (Dual Stack) â†’ VM

ã€ãƒ¡ãƒªãƒƒãƒˆã€‘
- IPv6 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«ç›´æ¥å¯¾å¿œ
- è¿½åŠ ã‚³ã‚¹ãƒˆãªã—

ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã€‘
- L7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒã§ããªã„
- FQDN ãƒ™ãƒ¼ã‚¹ã®ãƒ«ãƒ¼ãƒ«ãŒä½¿ãˆãªã„
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³ C: Dual Stack + NVA

```
ã€æ§‹æˆã€‘
Internet â†’ ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ NVA (Palo Alto, FortiGate ç­‰) â†’ VNet (Dual Stack)

ã€ãƒ¡ãƒªãƒƒãƒˆã€‘
- IPv6 + L7 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- Azure Firewall ã‚ˆã‚Šé«˜æ©Ÿèƒ½ãªå ´åˆã‚‚

ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã€‘
- é«˜ã‚³ã‚¹ãƒˆï¼ˆãƒ©ã‚¤ã‚»ãƒ³ã‚¹ + VMï¼‰
- é‹ç”¨è² è·ãŒé«˜ã„
- ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒè¤‡é›‘
```

## Private Endpoint ã¨ IPv6

ã‚‚ã†ä¸€ã¤ã®å¤§ããªåˆ¶ç´„ãŒ **Private Endpoint ãŒ IPv4 ã®ã¿** ã§ã‚ã‚‹ã“ã¨ã§ã™ã€‚

```
ã€Private Endpoint ã¨ã¯ï¼Ÿã€‘
Azure PaaS ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆStorage, SQL Database ç­‰ï¼‰ã«
VNet å†…ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ IP ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ©Ÿèƒ½

ã€å•é¡Œã€‘
Private Endpoint ã¯ IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã‚’ã‚µãƒãƒ¼ãƒˆ

ã€å½±éŸ¿ã€‘
VNet å†…ã§ Dual Stack ã‚’ä½¿ã£ã¦ã„ã¦ã‚‚ã€
PaaS ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯å¿…ãš IPv4 ã«ãªã‚‹

ä¾‹:
  VM (fd00::10) â†’ Private Endpoint (10.0.1.5) â†’ Azure Storage
  â””â”€ IPv6 ã§æ¥ç¶šã—ã‚ˆã†ã¨ã—ã¦ã‚‚ã€Private Endpoint çµŒç”±ã§ã¯ IPv4 ã«ãªã‚‹
```

## ã‚ˆã‚Šè©³ã—ãå­¦ã¶ã«ã¯

Azure ã§ã® IPv6 è¨­è¨ˆã«ã¤ã„ã¦è©³ã—ãçŸ¥ã‚ŠãŸã„æ–¹ã¯ã€ã€Œ[Azure é–‰åŸŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆå…¥é–€](https://zenn.dev/sbk0716/books/b39367c534044c)ã€ã®ä»¥ä¸‹ã®ç« ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

| ç«              | å†…å®¹                                                   |
| -------------- | ------------------------------------------------------ |
| **ç¬¬ 13 ç« **   | IPv6 Dual Stack ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã€Azure å›ºæœ‰ã®åˆ¶ç´„ã¨å¯¾ç­– |
| **Appendix F** | Azure ã‚µãƒ¼ãƒ“ã‚¹ IPv6 å¯¾å¿œçŠ¶æ³ï¼ˆå…¨ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§è¡¨ï¼‰       |
| **Appendix K** | AWS/GCP ã¨ã® IPv6 å¯¾å¿œæ¯”è¼ƒã€ã‚¯ãƒ©ã‚¦ãƒ‰é¸å®šã®åˆ¤æ–­ææ–™     |

> **æ›¸ç±ã¨ã®é–¢ä¿‚**
> ã“ã®è¨˜äº‹ã¯ IPv6 ã®**åŸºç¤ä½“é¨“**ã«ç„¦ç‚¹ã‚’å½“ã¦ã¦ã„ã¾ã™ã€‚Azure ã§ã®**å®Ÿè·µçš„ãªè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³**ã«ã¤ã„ã¦ã¯ã€æ›¸ç±ã§è©³ã—ãè§£èª¬ã—ã¦ãŠã‚Šã¾ã™ã€‚

---

# ã¾ã¨ã‚

ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼ã“ã®è¨˜äº‹ã§ã¯ã€Docker ã‚’ä½¿ã£ã¦ IPv6 Dual Stack ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã—ã¦ IPv6 ã®åŸºæœ¬å‹•ä½œã‚’ä½“é¨“ã—ã¾ã—ãŸã€‚

## ã“ã®è¨˜äº‹ã§å­¦ã‚“ã ã“ã¨

### ç†è«–é¢

| ãƒˆãƒ”ãƒƒã‚¯          | å­¦ã‚“ã ã“ã¨                                             |
| ----------------- | ------------------------------------------------------ |
| **IPv6 ã‚¢ãƒ‰ãƒ¬ã‚¹** | 128 ãƒ“ãƒƒãƒˆã€16 é€²æ•°è¡¨è¨˜ã€çœç•¥ãƒ«ãƒ¼ãƒ«                    |
| **ã‚¢ãƒ‰ãƒ¬ã‚¹ç¨®åˆ¥**  | ULAï¼ˆfd00::/8ï¼‰ã€GUAï¼ˆ2000::/3ï¼‰ã€LLAï¼ˆfe80::/10ï¼‰     |
| **DNS**           | A ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv4ï¼‰ã€AAAA ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆIPv6ï¼‰              |
| **Dual Stack**    | 1 ã¤ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã« IPv4 ã¨ IPv6 ã®ä¸¡æ–¹ã‚’å‰²ã‚Šå½“ã¦ |

### å®Ÿè·µé¢

| å®Ÿé¨“       | ä½“é¨“ã—ãŸã“ã¨         | ä½¿ã£ãŸã‚³ãƒãƒ³ãƒ‰                    |
| ---------- | -------------------- | --------------------------------- |
| **å®Ÿé¨“ 1** | IPv4/IPv6 ä¸¡æ–¹ã§é€šä¿¡ | `curl -4`, `curl -6`, `ping`      |
| **å®Ÿé¨“ 2** | DNS åå‰è§£æ±º         | `dig A`, `dig AAAA`               |
| **å®Ÿé¨“ 3** | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œ   | `curl -v`, `python3 ds_client.py` |

### é‡è¦ãªæ¦‚å¿µ

```
ã€Dual Stack ã® 3 ã¤ã®ä¾¡å€¤ã€‘
1. ç§»è¡Œæˆ¦ç•¥: IPv4 â†’ Dual Stack â†’ IPv6 ã¸ã®æ®µéšçš„ç§»è¡Œ
2. å¯ç”¨æ€§:   ç‰‡æ–¹ãŒå£Šã‚Œã¦ã‚‚ã€ã‚‚ã†ç‰‡æ–¹ã§ç¶™ç¶š
3. æŸ”è»Ÿæ€§:   ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«å¿œã˜ã¦æœ€é©ãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’é¸æŠ

ã€Happy Eyeballsï¼ˆRFC 8305ï¼‰ã€‘
- IPv6 ã‚’å„ªå…ˆã—ã¦æ¥ç¶šè©¦è¡Œ
- 250ms å¾…ã£ã¦ã‚‚å¿œç­”ãŒãªã‘ã‚Œã° IPv4 ã‚‚ä¸¦åˆ—è©¦è¡Œ
- å…ˆã«æˆåŠŸã—ãŸæ–¹ã‚’ä½¿ç”¨
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å¾…ãŸã•ã‚Œãªã„
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®è¨˜äº‹ã§ IPv6 ã®åŸºç¤ã‚’å­¦ã‚“ã å¾Œã¯ã€ä»¥ä¸‹ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ç†è§£ã‚’æ·±ã‚ã¦ã„ãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

### ã™ãã«ã§ãã‚‹ã“ã¨

- [ ] ã“ã®ãƒ©ãƒœç’°å¢ƒã§è¿½åŠ ã®å®Ÿé¨“ã‚’è¡Œã†ï¼ˆåˆ¥ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿½åŠ ã€iptables ã§ IPv6 ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã¿ã‚‹ç­‰ï¼‰
- [ ] è‡ªç¤¾ã®ã‚·ã‚¹ãƒ†ãƒ ã§ IPv6 å¯¾å¿œçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹ï¼ˆ`dig AAAA example.com`ï¼‰
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã€å®Ÿéš›ã®ã‚µã‚¤ãƒˆãŒ IPv4/IPv6 ã©ã¡ã‚‰ã§æ¥ç¶šã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹

### ã‚ˆã‚Šæ·±ãå­¦ã¶

- [ ] ã€Œ[Azure é–‰åŸŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­è¨ˆå…¥é–€](https://zenn.dev/sbk0716/books/b39367c534044c)ã€ã® **ç¬¬ 13 ç« ** ã§ Azure ã§ã® IPv6 è¨­è¨ˆã‚’å­¦ã¶
- [ ] **Appendix F** ã§ Azure ã‚µãƒ¼ãƒ“ã‚¹ã® IPv6 å¯¾å¿œçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹
- [ ] **Appendix K** ã§ AWS/GCP ã¨ã®æ¯”è¼ƒã‚’èª­ã‚€

### ç™ºå±•çš„ãªãƒˆãƒ”ãƒƒã‚¯

- [ ] SLAAC ã¨ DHCPv6 ã®é•ã„ã‚’ç†è§£ã™ã‚‹
- [ ] IPv6 only ç’°å¢ƒï¼ˆNAT64/DNS64ï¼‰ã‚’è©¦ã—ã¦ã¿ã‚‹
- [ ] Kubernetes ã§ã® IPv6 Dual Stack ã‚’æ¤œè¨¼ã™ã‚‹

## å¾Œç‰‡ä»˜ã‘

ãƒ©ãƒœç’°å¢ƒã‚’åœæ­¢ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ã„ã‚‹å ´åˆã¯ã€ã¾ãš exit ã§ã‚³ãƒ³ãƒ†ãƒŠã‹ã‚‰å‡ºã‚‹
exit

# ãƒ©ãƒœç’°å¢ƒã‚’åœæ­¢ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
./stop.sh
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›**:

```
==========================================
Stopping Dual Stack Lab...
==========================================

### Stopping containers ###
[+] Running 4/4
 âœ” Container rd-ds-client  Removed
 âœ” Container rd-ds-web     Removed
 âœ” Container rd-ds-dns     Removed
 âœ” Network rd-dualstack-lab_dsnet  Removed

==========================================
Lab stopped and cleaned up.
==========================================
```

## æœ€å¾Œã«

IPv6 ã¯ã€Œå°†æ¥ã®ãŸã‚ã®æŠ€è¡“ã€ã§ã¯ãªãã€**ã™ã§ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹æŠ€è¡“**ã§ã™ã€‚ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã¯ IPv6 ãŒæ¨™æº–ã§ã‚ã‚Šã€å¤šãã® Web ã‚µã‚¤ãƒˆãŒ Dual Stack ã§é‹ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹ãŒã€IPv6 ã‚’å­¦ã¶ç¬¬ä¸€æ­©ã¨ã—ã¦å½¹ç«‹ã¦ã°å¹¸ã„ã§ã™ã€‚

---

# å‚è€ƒãƒªãƒ³ã‚¯

## ãƒãƒ³ã‚ºã‚ªãƒ³ç’°å¢ƒ

https://github.com/sbk0716/rd-dualstack-lab

## é–¢é€£æ›¸ç±

https://zenn.dev/sbk0716/books/b39367c534044c

## RFCï¼ˆæŠ€è¡“ä»•æ§˜ï¼‰

| RFC                                                       | ã‚¿ã‚¤ãƒˆãƒ«                                       | å†…å®¹                     |
| --------------------------------------------------------- | ---------------------------------------------- | ------------------------ |
| [RFC 4193](https://datatracker.ietf.org/doc/html/rfc4193) | Unique Local IPv6 Unicast Addresses            | ULA ã®å®šç¾©               |
| [RFC 6724](https://datatracker.ietf.org/doc/html/rfc6724) | Default Address Selection for IPv6             | ã‚¢ãƒ‰ãƒ¬ã‚¹é¸æŠã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |
| [RFC 8305](https://datatracker.ietf.org/doc/html/rfc8305) | Happy Eyeballs Version 2                       | IPv4/IPv6 ä¸¦åˆ—æ¥ç¶š       |
| [RFC 3849](https://datatracker.ietf.org/doc/html/rfc3849) | IPv6 Address Prefix Reserved for Documentation | 2001:db8::/32            |

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

| ãƒªã‚½ãƒ¼ã‚¹                                                                                           | èª¬æ˜                             |
| -------------------------------------------------------------------------------------------------- | -------------------------------- |
| [Azure IPv6 Overview](https://learn.microsoft.com/azure/virtual-network/ip-services/ipv6-overview) | Azure ã® IPv6 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ   |
| [Docker IPv6 Networking](https://docs.docker.com/config/daemon/ipv6/)                              | Docker ã§ã® IPv6 è¨­å®š            |
| [CoreDNS Documentation](https://coredns.io/manual/toc/)                                            | CoreDNS å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ         |
| [Rancher Desktop Documentation](https://docs.rancherdesktop.io/)                                   | Rancher Desktop å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |

## å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

| ãƒªã‚½ãƒ¼ã‚¹                                                                      | èª¬æ˜                             |
| ----------------------------------------------------------------------------- | -------------------------------- |
| [IPv6 - Wikipedia](https://ja.wikipedia.org/wiki/IPv6)                        | IPv6 ã®æ¦‚è¦                      |
| [Test your IPv6 connectivity](https://test-ipv6.com/)                         | ã‚ãªãŸã®ç’°å¢ƒãŒ IPv6 å¯¾å¿œã‹ãƒ†ã‚¹ãƒˆ |
| [IPv6 Deployment Status](https://www.google.com/intl/en/ipv6/statistics.html) | Google ã«ã‚ˆã‚‹ IPv6 æ™®åŠç‡çµ±è¨ˆ    |

---

# ä»˜éŒ²: å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¼•ç”¨é›†ï¼ˆè¨­è¨ˆæ™‚ã®è¨¼è·¡ï¼‰

ã“ã®è¨˜äº‹ã§å¼•ç”¨ã—ãŸå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åŸæ–‡ã‚’ã€è¨­è¨ˆåˆ¤æ–­ã®è¨¼è·¡ã¨ã—ã¦è¨˜è¼‰ã—ã¾ã™ã€‚

## IPv4 ã‚¢ãƒ‰ãƒ¬ã‚¹æ¯æ¸‡

**å‡ºå…¸**: [IANA IPv4 Address Space Registry](https://www.iana.org/assignments/ipv4-address-space/ipv4-address-space.xhtml)

| RIR        | æ¯æ¸‡æ—¥          | å‚™è€ƒ                                     |
| ---------- | --------------- | ---------------------------------------- |
| IANA       | 2011å¹´2æœˆ3æ—¥    | æœ€å¾Œã® /8 ãƒ–ãƒ­ãƒƒã‚¯ã‚’ 5 ã¤ã® RIR ã«åˆ†é…   |
| APNIC      | 2011å¹´4æœˆ15æ—¥   | ã‚¢ã‚¸ã‚¢å¤ªå¹³æ´‹åœ°åŸŸï¼ˆæ—¥æœ¬ã‚’å«ã‚€ï¼‰           |
| RIPE NCC   | 2012å¹´9æœˆ14æ—¥   | ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã€ä¸­æ±ã€ä¸­å¤®ã‚¢ã‚¸ã‚¢             |
| LACNIC     | 2014å¹´6æœˆ10æ—¥   | ä¸­å—ç±³ã€ã‚«ãƒªãƒ–æµ·                         |
| ARIN       | 2015å¹´9æœˆ24æ—¥   | åŒ—ç±³                                     |
| AFRINIC    | 2017å¹´4æœˆ21æ—¥   | ã‚¢ãƒ•ãƒªã‚«                                 |

## RFC 8305 - Happy Eyeballs Version 2

**å‡ºå…¸**: [RFC 8305](https://datatracker.ietf.org/doc/html/rfc8305)

**Section 5 - Resolution Delay**:
> "The recommended value for the Resolution Delay is 50 milliseconds."

**Section 8 - Connection Attempt Delay**:
> "The recommended value for the Connection Attempt Delay is 250 milliseconds."
>
> "A Connection Attempt Delay MUST NOT be less than 100 ms, and SHOULD NOT be less than 10 ms. A Connection Attempt Delay SHOULD NOT be greater than 2 seconds."

## Azure IPv6 å¯¾å¿œçŠ¶æ³

**å‡ºå…¸**: [Azure IPv6 Overview - Microsoft Learn](https://learn.microsoft.com/azure/virtual-network/ip-services/ipv6-overview)ï¼ˆ2026å¹´1æœˆæ™‚ç‚¹ï¼‰

**Azure Firewall ã«ã¤ã„ã¦**:
> "Azure Firewall doesn't currently support IPv6. It can operate in a dual stack virtual network using only IPv4, but the firewall subnet must be IPv4-only."

**IPv6 éå¯¾å¿œã‚µãƒ¼ãƒ“ã‚¹**:
> "Azure services that don't support IPv6 include:
> - Azure Container Instances
> - Azure Container Apps
> - Azure Virtual WAN
> - Azure Route Server
> - Azure Firewall
> - Azure Database for PostgreSQL"

## AWS Network Firewall IPv6 å¯¾å¿œ

**å‡ºå…¸**: [AWS Network Firewall now supports IPv6](https://aws.amazon.com/about-aws/whats-new/2023/01/aws-network-firewall-supports-ipv6/)ï¼ˆ2023å¹´1æœˆï¼‰

> "AWS Network Firewall now supports IPv6, allowing customers to deploy the firewall in dual-stack VPCs."

**IPv6-only ã‚µãƒ–ãƒãƒƒãƒˆå¯¾å¿œ**: 2023å¹´4æœˆ

**å‡ºå…¸**: [AWS Network Firewall now supports IPv6-only subnets](https://aws.amazon.com/about-aws/whats-new/2023/04/aws-network-firewall-ipv6-only-subnets/)

## GCP VPC Firewall Rules

**å‡ºå…¸**: [VPC firewall rules overview - Google Cloud](https://cloud.google.com/firewall/docs/firewalls)

> "IPv6 connections are supported in VPC networks that have IPv6 enabled."
>
> "VPC firewall rules support the following protocols: TCP, UDP, SCTP, ICMP, ICMPv6"

---

> **æ³¨æ„**: ä¸Šè¨˜ã®æƒ…å ±ã¯ 2026å¹´1æœˆæ™‚ç‚¹ã®ã‚‚ã®ã§ã™ã€‚ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã® IPv6 å¯¾å¿œçŠ¶æ³ã¯éšæ™‚æ›´æ–°ã•ã‚Œã‚‹ãŸã‚ã€è¨­è¨ˆæ™‚ã«ã¯å¿…ãšæœ€æ–°ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚
